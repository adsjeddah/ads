# ุณููู ุญุฐู ุงููุงุชูุฑุฉ

## ๐ ูุง ูุญุฏุซ ุนูุฏ ุญุฐู ูุงุชูุฑุฉุ

### โ ุงูุนูููุงุช ุงูุชู ุชุชู ุชููุงุฆูุงู:

```
1๏ธโฃ ุญุฐู ุงููุงุชูุฑุฉ
   โโ ุชูุญุฐู ุงููุงุชูุฑุฉ ููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   
2๏ธโฃ ุฅููุงู ุงูุงุดุชุฑุงู ุงููุฑุชุจุท
   โโ ูุชู ุชุญุฏูุซ status ุฅูู 'cancelled'
   โโ ููุณุฌู ุชุงุฑูุฎ ุงูุฅูุบุงุก (cancelled_at)
   โโ ููุณุฌู ุงูุณุจุจ: "ุชู ุญุฐู ุงููุงุชูุฑุฉ ูู ูุจู ุงูุฅุฏุงุฑุฉ"
   
3๏ธโฃ ุฅููุงู ุงููุนูู ๐ (ููุชุงุญ ุฅุฎูุงุก ุงูุฅุนูุงู)
   โโ ูุชู ุชุญุฏูุซ status ุงููุนูู ุฅูู 'inactive'
   โโ ูุฐุง ูุง ูููู ุธููุฑ ุงูุฅุนูุงู ุนูู ุงููููุน ูุนููุงู
   
4๏ธโฃ ุฅููุงู ุงูุฅุนูุงู
   โโ ุงูุฅุนูุงู ูุชููู ุนู ุงูุธููุฑ ููุฑุงู
   โโ ุงููููุน ูุนุฑุถ ููุท ุงููุนูููู ุฐูู status: 'active'
   โโ ุจูุง ุฃู ุงููุนูู ุฃุตุจุญ 'inactive'ุ ูู ูุธูุฑ ููุฒูุงุฑ
```

### ๐ ูุง ูุชู ุงูุญูุงุธ ุนููู (ููุฃุฑุดูู):

```
โ ุงูุงุดุชุฑุงู (Subscription)
   - ูุจูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
   - status = 'cancelled'
   - ุฌููุน ูุนูููุงุช ุงูุงุดุชุฑุงู ูุญููุธุฉ
   
โ ุงููุฏููุนุงุช (Payments)
   - ุฌููุน ุณุฌูุงุช ุงููุฏููุนุงุช ูุญููุธุฉ
   - ูููู ุงูุฑุฌูุน ุฅูููุง ูุงุญูุงู
   
โ Audit Log
   - ููุณุฌู ุนูููุฉ ุงูุญุฐู
   - ููุณุฌู ุฅููุงู ุงูุงุดุชุฑุงู
   - ูููุฑุงุฌุนุฉ ูุงูุชุฏููู
```

---

## ๐ฏ ูุชู ุชุณุชุฎุฏู ุญุฐู ุงููุงุชูุฑุฉุ

### โ ุงูุงุณุชุฎุฏุงูุงุช ุงูุตุญูุญุฉ:

1. **ุฅูุบุงุก ุงุดุชุฑุงู ุนููู**
   - ุงูุนููู ุทูุจ ุฅููุงู ุฎุฏูุชู
   - ุนุฏู ุงูุฑุบุจุฉ ูู ุงุณุชูุฑุงุฑ ุงูุฅุนูุงู

2. **ุชุตุญูุญ ุฎุทุฃ ูุจูุฑ**
   - ูุงุชูุฑุฉ ุฎุงุทุฆุฉ ุชูุงูุงู
   - ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ

3. **ุนููู ูู ูุฏูุน**
   - ูุถู ููุช ุทููู ุจุฏูู ุฏูุน
   - ูุฑุงุฑ ุฅุฏุงุฑู ุจุฅููุงู ุงูุฎุฏูุฉ

### โ๏ธ ุชุญุฐูุฑุงุช:

```
โ ูุง ุชุญุฐู ุงููุงุชูุฑุฉ ุฅุฐุง:
   - ุชุฑูุฏ ููุท ุชุนุฏูู ุงููุจูุบ โ ุงุณุชุฎุฏู ุงูุชุนุฏูู
   - ุชุฑูุฏ ุชุณุฌูู ุฏูุนุฉ ุฅุถุงููุฉ โ ุงุณุชุฎุฏู ุชุณุฌูู ุฏูุนุฉ
   - ุงูุนููู ูู ูุชุฑุฉ ุณูุงุญ โ ุงูุชุธุฑ ุฃู ูุฏุฏ ุงูุณูุงุญ
```

---

## ๐ ูุธุงู ุงูุฃูุงู:

### ุชุฃููุฏ ูุฒุฏูุฌ:

```
1๏ธโฃ ุงูุชุฃููุฏ ุงูุฃูู:
   "โ๏ธ ูู ุฃูุช ูุชุฃูุฏุ"
   ููุถุญ: ุญุฐู ุงููุงุชูุฑุฉ + ุฅููุงู ุงูุงุดุชุฑุงู + ุฅููุงู ุงูุฅุนูุงู
   
2๏ธโฃ ุงูุชุฃููุฏ ุงูุซุงูู:
   "โ ุชุฃููุฏ ููุงุฆู"
   ุชุฃููุฏ ุฃุฎูุฑ ูุจู ุงูุชูููุฐ
```

### ุฑุณุงูุฉ ุงููุฌุงุญ:

```
โ "ุชู ุญุฐู ุงููุงุชูุฑุฉ ูุฅููุงู ุงูุงุดุชุฑุงู ุจูุฌุงุญ"

โข ุงููุงุชูุฑุฉ: ูุญุฐููุฉ โ
โข ุงูุงุดุชุฑุงู: ูุชููู โ
โข ุงูุฅุนูุงู: ูุชููู ุนู ุงูุธููุฑ โ
```

---

## ๐ ุงูุชุฃุซูุฑ ุนูู ุงููุธุงู:

| ุงูุนูุตุฑ | ูุง ูุญุฏุซ | ุงูุญุงูุฉ ุงูููุงุฆูุฉ |
|--------|---------|------------------|
| **ุงููุงุชูุฑุฉ** | ุชูุญุฐู ููุงุฆูุงู | ๐๏ธ ูุญุฐููุฉ |
| **ุงูุงุดุชุฑุงู** | status โ cancelled | ๐ ูุชููู (ูุญููุธ) |
| **ุงููุนูู** | status โ inactive ๐ | ๐ซ ุบูุฑ ูุดุท (ูุญููุธ) |
| **ุงูุฅุนูุงู** | ูุฎุชูู ูู ุงููููุน | ๐ซ ุบูุฑ ุธุงูุฑ ููุฒูุงุฑ |
| **ุงููุฏููุนุงุช** | ูุง ุชุชุฃุซุฑ | โ ูุญููุธุฉ |
| **Audit Log** | ุชูุณุฌู ุงูุนูููุฉ | ๐ ูุณุฌูุฉ |

---

## ๐ ุงุณุชุนุงุฏุฉ ุงูุงุดุชุฑุงู:

ุฅุฐุง ุฃุฑุฏุช ุงุณุชุนุงุฏุฉ ุงูุงุดุชุฑุงู ุจุนุฏ ุงูุญุฐู:

```
1. ุงูุงุดุชุฑุงู ููุฌูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ูููู ุฅุนุงุฏุฉ ุชูุนููู ูุฏููุงู
3. ุบูุฑ status ูู 'cancelled' ุฅูู 'active'
4. ุฃู ุฃูุดุฆ ุงุดุชุฑุงู ุฌุฏูุฏ
```

---

## ๐ ููุงุญุธุงุช ูููุฉ:

1. **ูุง ูููู ุงูุชุฑุงุฌุน ุนู ุญุฐู ุงููุงุชูุฑุฉ**
   - ุงููุงุชูุฑุฉ ุชูุญุฐู ููุงุฆูุงู
   - ููู ุงูุงุดุชุฑุงู ูุจูู (ููุฃุฑุดูู)

2. **ุงูุฅุนูุงู ูุชููู ููุฑุงู**
   - ุจูุฌุฑุฏ ุชุบููุฑ status ุฅูู 'cancelled'
   - ุงููุธุงู ูุชุฌุงูู ุงูุงุดุชุฑุงูุงุช ุงูููุบุงุฉ

3. **ุงูุณุฌูุงุช ุงููุญููุธุฉ**
   - ูููู ูุฑุงุฌุนุฉ ุชุงุฑูุฎ ุงูุงุดุชุฑุงู
   - ูููู ูุนุฑูุฉ ุงููุฏููุนุงุช ุงูุณุงุจูุฉ
   - Audit log ูุญูุธ ูู ุดูุก

---

## ๐๏ธ ุงูุชูุงุตูู ุงูุชูููุฉ:

### ุงูููุฏ ุงููููุฐ:

```typescript
// 1. ุญุฐู ุงููุงุชูุฑุฉ
InvoiceAdminService.delete(invoiceId);

// 2. ุชุญุฏูุซ ุงูุงุดุชุฑุงู
await subscriptionRef.update({
  status: 'cancelled',
  cancelled_at: FieldValue.serverTimestamp(),
  cancellation_reason: 'ุชู ุญุฐู ุงููุงุชูุฑุฉ ูู ูุจู ุงูุฅุฏุงุฑุฉ'
});

// 3. ๐ ุชุญุฏูุซ ุญุงูุฉ ุงููุนูู (ูุฐุง ูุง ูููู ุงูุฅุนูุงู!)
await advertiserRef.update({
  status: 'inactive',
  updated_at: FieldValue.serverTimestamp()
});

// 4. ุชุณุฌูู ูู Audit Log
await adminDb.collection('audit_logs').add({
  entity_type: 'invoice',
  action: 'delete_with_cancellation',
  details: {
    invoice_id: id,
    subscription_id: subscriptionId,
    advertiser_id: advertiserId  // ๐
  }
});
```

### ๐ ููุชุงุญ ุฅุฎูุงุก ุงูุฅุนูุงู:

```
ุงููููุน ูุนุฑุถ ุงูุฅุนูุงูุงุช ุจูุงุกู ุนูู:
axios.get('/api/advertisers?status=active')

ูุจู ุงูุญุฐู:
advertiser.status === 'active' โ โ ูุธูุฑ ุงูุฅุนูุงู

ุจุนุฏ ุงูุญุฐู:
advertiser.status === 'inactive' โ โ ูุง ูุธูุฑ ุงูุฅุนูุงู
```

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-11-24  
**ุงูุฅุตุฏุงุฑ:** 2.0 - ุญุฐู ูุน ุฅููุงู ุงูุงุดุชุฑุงู

