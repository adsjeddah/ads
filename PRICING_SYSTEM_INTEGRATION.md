# ğŸ”— Ø¯Ù„ÙŠÙ„ ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„

> **ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«:** 22 Ù†ÙˆÙÙ…Ø¨Ø± 2025  
> **Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ù…Ø·Ø¨Ù‚ ÙˆÙ…ØªÙƒØ§Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„

---

## ğŸ“‹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±](#Ø§Ù„Ø¨Ø§Ù‚Ø§Øª-ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±)
3. [Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†](#Ø§Ø±ØªØ¨Ø§Ø·-Ø§Ù„Ø¨Ø§Ù‚Ø§Øª-Ø¨Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†)
4. [Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª](#Ø§Ø±ØªØ¨Ø§Ø·-Ø§Ù„Ø¨Ø§Ù‚Ø§Øª-Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª)
5. [Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ±](#Ø§Ø±ØªØ¨Ø§Ø·-Ø§Ù„Ø¨Ø§Ù‚Ø§Øª-Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ±)
6. [Ø­Ø³Ø§Ø¨ VAT](#Ø­Ø³Ø§Ø¨-vat)
7. [Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª](#Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª)
8. [Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª](#Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª)
9. [Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª](#Ø§Ù„Ø­Ø§Ù„Ø§Øª-ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª)
10. [Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ© ÙƒØ§Ù…Ù„Ø©](#Ø£Ù…Ø«Ù„Ø©-Ø¹Ù…Ù„ÙŠØ©-ÙƒØ§Ù…Ù„Ø©)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©

### ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ADVERTISER â”‚  Ø§Ù„Ù…Ø¹Ù„Ù†
â”‚   (Ù…Ø¹Ù„Ù†)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PLAN     â”‚  Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
â”‚   (Ø¨Ø§Ù‚Ø©)     â”‚  â€¢ Ø£Ø³Ø¨ÙˆØ¹: 400
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ Ø´Ù‡Ø±: 1500
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUBSCRIPTION â”‚  Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
â”‚  (Ø§Ø´ØªØ±Ø§Ùƒ)    â”‚  â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
       â”‚           â€¢ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
       â†“           â€¢ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INVOICE    â”‚  Ø§Ù„ÙØ§ØªÙˆØ±Ø©
â”‚  (ÙØ§ØªÙˆØ±Ø©)    â”‚  â€¢ Subtotal
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ VAT (15%)
       â”‚           â€¢ Amount (Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PAYMENT    â”‚  Ø§Ù„Ø¯ÙØ¹Ø©
â”‚   (Ø¯ÙØ¹Ø©)     â”‚  â€¢ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹
```

---

## ğŸ’° Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±

### Firebase Collection: `plans`

```javascript
// Ø¨Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
{
  id: "PLAN-WEEK-001",
  name: "Ø¨Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",
  duration_days: 7,
  price: 400,  // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
  is_active: true
}

// Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ©
{
  id: "PLAN-MONTH-001",
  name: "Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ©",
  duration_days: 30,
  price: 1500,  // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
  is_active: true
}
```

### API Endpoint

```typescript
GET /api/plans

Response:
[
  {
    id: "cNAPAWGoSre3XRMnL1N5",
    name: "Ø¨Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",
    duration_days: 7,
    price: 400,
    features: [...]
  },
  {
    id: "xAXqTLInisLuglofuQkH",
    name: "Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ©",
    duration_days: 30,
    price: 1500,
    features: [...]
  }
]
```

---

## ğŸ‘¤ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†

### Data Model

```typescript
// Advertiser
{
  id: "ADV-001",
  business_name: "Ø´Ø±ÙƒØ© Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ù„ØªØ³ÙˆÙŠÙ‚",
  email: "info@success.com",
  phone: "0501234567",
  status: "active"
}
```

### Ø§Ù„Ø¹Ù„Ø§Ù‚Ø©

```
Advertiser (1) â”€â”€â–º Subscription (Many)
    â†“
   ÙŠÙ…ÙƒÙ† Ù„Ù„Ù…Ø¹Ù„Ù† Ø§Ù„ÙˆØ§Ø­Ø¯ Ø£Ù† ÙŠÙƒÙˆÙ† Ù„Ù‡ Ø¹Ø¯Ø© Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
   Ù…Ø«Ù„Ø§Ù‹: Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ + Ø§Ø´ØªØ±Ø§Ùƒ Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª
```

---

## ğŸ“… Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª

### Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯

```typescript
// API: POST /api/financial/create-subscription
{
  advertiser_id: "ADV-001",
  plan_id: "xAXqTLInisLuglofuQkH",  // Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
  start_date: "2025-11-22",
  vat_percentage: 15
}
```

### Ù…Ø§ ÙŠØ­Ø¯Ø« Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹

```javascript
// 1. Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø§Ù‚Ø©
const plan = await PlanService.getById(plan_id);
// plan.price = 1500
// plan.duration_days = 30

// 2. Ø­Ø³Ø§Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
const startDate = new Date("2025-11-22");
const endDate = addDays(startDate, 30);
// endDate = "2025-12-22"

// 3. Ø­Ø³Ø§Ø¨ VAT
const subtotal = 1500;
const vat_amount = 1500 * 0.15 = 225;
const total = 1500 + 225 = 1725;

// 4. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
{
  id: "SUB-001",
  advertiser_id: "ADV-001",
  plan_id: "xAXqTLInisLuglofuQkH",
  start_date: "2025-11-22",
  end_date: "2025-12-22",
  base_price: 1500,
  total_amount: 1725,  // Ù…Ø¹ VAT
  paid_amount: 0,
  remaining_amount: 1725,
  status: "active",
  payment_status: "pending"
}
```

---

## ğŸ§¾ Ø§Ø±ØªØ¨Ø§Ø· Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ±

### Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙÙ†Ø´Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ

```javascript
// Invoice Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
{
  id: "INV-001",
  subscription_id: "SUB-001",
  invoice_number: "INV-2025-001",
  
  // Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¨Ø§Ù‚Ø©)
  subtotal: 1500,        // Ù…Ù† plan.price
  vat_percentage: 15,    
  vat_amount: 225,       // Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
  amount: 1725,          // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
  
  // Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® (Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ)
  issued_date: "2025-11-22",  // Ù…Ù† subscription.start_date
  due_date: "2025-12-22",     // Ù…Ù† subscription.end_date
  
  // Ø§Ù„Ø­Ø§Ù„Ø©
  status: "unpaid"
}
```

### Service: FinancialService.createSubscriptionWithInvoice()

```typescript
// ÙÙŠ lib/services/financial.service.ts

static async createSubscriptionWithInvoice(data) {
  // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ø§Ù‚Ø©
  const plan = await PlanService.getById(data.plan_id);
  
  // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
  const endDate = addDays(data.start_date, plan.duration_days);
  
  // 3. Ø­Ø³Ø§Ø¨ VAT
  const vat = this.calculateVAT(plan.price, 15);
  // vat = { vat_amount: 225, total_with_vat: 1725 }
  
  // 4. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  const subscriptionId = await SubscriptionService.create({
    ...data,
    base_price: plan.price,
    total_amount: vat.total_with_vat
  });
  
  // 5. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  const invoiceId = await InvoiceService.create({
    subscription_id: subscriptionId,
    subtotal: plan.price,
    vat_amount: vat.vat_amount,
    amount: vat.total_with_vat
  });
  
  return { subscriptionId, invoiceId };
}
```

---

## ğŸ’ Ø­Ø³Ø§Ø¨ VAT

### Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©: VAT = 15%

```javascript
// ÙÙŠ FinancialService
calculateVAT(subtotal, vatPercentage = 15) {
  const vat_amount = subtotal * (vatPercentage / 100);
  const total_with_vat = subtotal + vat_amount;
  
  return {
    vat_amount: Math.round(vat_amount * 100) / 100,
    total_with_vat: Math.round(total_with_vat * 100) / 100
  };
}
```

### Ø£Ù…Ø«Ù„Ø© Ø¨Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©

```javascript
// Ø¨Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
calculateVAT(400, 15)
// { vat_amount: 60, total_with_vat: 460 }

// Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ©
calculateVAT(1500, 15)
// { vat_amount: 225, total_with_vat: 1725 }

// Ø¨Ø§Ù‚Ø© Ø³Ù†ÙˆÙŠØ©
calculateVAT(14000, 15)
// { vat_amount: 2100, total_with_vat: 16100 }
```

---

## ğŸ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª

### Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª

```typescript
// 1. Ø®ØµÙ… Ø¨Ø§Ù„Ù…Ø¨Ù„Øº
discount_type: 'amount'
discount_amount: 100

// Ù…Ø«Ø§Ù„: Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ© (1500 Ø±ÙŠØ§Ù„)
base_price: 1500
discount: -100
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subtotal: 1400
VAT (15%): 210
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
total: 1610 Ø±ÙŠØ§Ù„

// 2. Ø®ØµÙ… Ø¨Ø§Ù„Ù†Ø³Ø¨Ø©
discount_type: 'percentage'
discount_amount: 10  // 10%

// Ù…Ø«Ø§Ù„: Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ© (1500 Ø±ÙŠØ§Ù„)
base_price: 1500
discount (-10%): -150
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subtotal: 1350
VAT (15%): 202.5
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
total: 1552.5 Ø±ÙŠØ§Ù„
```

### Service: FinancialService.calculateDiscount()

```typescript
static calculateDiscount(
  basePrice: number,
  discountType: 'amount' | 'percentage',
  discountAmount: number
) {
  let finalPrice = basePrice;
  
  if (discountType === 'amount') {
    finalPrice = basePrice - discountAmount;
  } else if (discountType === 'percentage') {
    finalPrice = basePrice - (basePrice * (discountAmount / 100));
  }
  
  return {
    base_price: basePrice,
    discount_type: discountType,
    discount_amount: discountAmount,
    total_amount: Math.max(0, finalPrice)
  };
}
```

### Ù…Ø«Ø§Ù„ ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø®ØµÙ…

```typescript
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ Ù…Ø¹ Ø®ØµÙ… 10%
POST /api/financial/create-subscription
{
  advertiser_id: "ADV-001",
  plan_id: "xAXqTLInisLuglofuQkH",  // Ø´Ù‡Ø±ÙŠ 1500
  start_date: "2025-11-22",
  discount_type: "percentage",
  discount_amount: 10,
  vat_percentage: 15
}

// Ø§Ù„Ù†ØªÙŠØ¬Ø©:
Subscription: {
  base_price: 1500,
  discount_type: "percentage",
  discount_amount: 10,
  // Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: 1500 - 150 = 1350
  total_amount: 1552.5  // 1350 + VAT(202.5)
}

Invoice: {
  subtotal: 1350,      // Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
  vat_percentage: 15,
  vat_amount: 202.5,
  amount: 1552.5       // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
}
```

---

## ğŸ’³ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª

### ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©

```typescript
// API: POST /api/financial/record-payment
{
  subscription_id: "SUB-001",
  invoice_id: "INV-001",
  amount: 1725,
  payment_method: "credit_card",
  payment_date: "2025-11-22"
}
```

### Ù…Ø§ ÙŠØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

```javascript
// 1. Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø©
Payment: {
  id: "PAY-001",
  subscription_id: "SUB-001",
  invoice_id: "INV-001",
  amount: 1725,
  payment_date: "2025-11-22",
  payment_method: "credit_card"
}

// 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
Subscription (SUB-001): {
  paid_amount: 1725,           // ÙƒØ§Ù† 0
  remaining_amount: 0,         // ÙƒØ§Ù† 1725
  payment_status: "paid"       // ÙƒØ§Ù† pending
}

// 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø©
Invoice (INV-001): {
  status: "paid",              // ÙƒØ§Ù† unpaid
  paid_date: "2025-11-22"      // Ø£ÙØ¶ÙŠÙ Ø§Ù„Ø¢Ù†
}

// 4. Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚
AuditLog: {
  entity_type: "invoice",
  entity_id: "INV-001",
  action: "payment_recorded",
  changes: { status: "unpaid â†’ paid" }
}
```

### Service: FinancialService.recordPayment()

```typescript
static async recordPayment(data) {
  // 1. Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙØ¹Ø©
  const paymentId = await PaymentService.create(data);
  
  // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  const subscription = await SubscriptionService.getById(
    data.subscription_id
  );
  
  // 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  const newPaidAmount = subscription.paid_amount + data.amount;
  const newRemainingAmount = subscription.total_amount - newPaidAmount;
  
  // 4. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  let paymentStatus = 'pending';
  if (newRemainingAmount <= 0) {
    paymentStatus = 'paid';
  } else if (newPaidAmount > 0) {
    paymentStatus = 'partial';
  }
  
  // 5. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  await SubscriptionService.update(data.subscription_id, {
    paid_amount: newPaidAmount,
    remaining_amount: Math.max(0, newRemainingAmount),
    payment_status: paymentStatus
  });
  
  // 6. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø¯ÙÙˆØ¹Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
  if (paymentStatus === 'paid' && data.invoice_id) {
    await InvoiceService.update(data.invoice_id, {
      status: 'paid',
      paid_date: new Date()
    });
    
    // 7. Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ ØªØ¯Ù‚ÙŠÙ‚
    await AuditService.logInvoiceAction(
      data.invoice_id,
      'payment_recorded',
      { amount: data.amount }
    );
  }
  
  return paymentId;
}
```

---

## ğŸ”„ Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª

### Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Subscription)

```typescript
status: 'active' | 'expired' | 'cancelled'
payment_status: 'pending' | 'partial' | 'paid'

// Ø£Ù…Ø«Ù„Ø©
{
  status: "active",
  payment_status: "pending",
  remaining_amount: 1725
}
// âœ Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø· Ù„ÙƒÙ† Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹

{
  status: "active",
  payment_status: "partial",
  paid_amount: 500,
  remaining_amount: 1225
}
// âœ Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø· Ù…Ø¹ Ø¯ÙØ¹Ø© Ø¬Ø²Ø¦ÙŠØ©

{
  status: "active",
  payment_status: "paid",
  remaining_amount: 0
}
// âœ Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø· ÙˆÙ…Ø¯ÙÙˆØ¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ âœ…

{
  status: "expired",
  payment_status: "paid"
}
// âœ Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ù†ØªÙ‡ÙŠ (Ø¨Ø¹Ø¯ end_date)
```

### Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Invoice)

```typescript
status: 'unpaid' | 'paid' | 'cancelled' | 'refunded'

// Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
unpaid â”€â”€â–º paid      // Ø¹Ù†Ø¯ Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨Ù„Øº ÙƒØ§Ù…Ù„Ø§Ù‹
paid â”€â”€â–º refunded    // Ø¹Ù†Ø¯ Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¨Ù„Øº
unpaid â”€â”€â–º cancelled // Ø¹Ù†Ø¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
```

### Cloud Function: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹

```javascript
// functions/index.js
exports.updateSubscriptionStatuses = functions.pubsub
  .schedule('0 0 * * *')  // ÙƒÙ„ ÙŠÙˆÙ… Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„
  .onRun(async (context) => {
    const today = new Date();
    
    // Ø¬Ù„Ø¨ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
    const expiredSubscriptions = await db
      .collection('subscriptions')
      .where('end_date', '<', today)
      .where('status', '==', 'active')
      .get();
    
    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙ‡Ø§
    for (const doc of expiredSubscriptions.docs) {
      await doc.ref.update({ status: 'expired' });
    }
  });
```

---

## ğŸ¬ Ø£Ù…Ø«Ù„Ø© Ø¹Ù…Ù„ÙŠØ© ÙƒØ§Ù…Ù„Ø©

### Ù…Ø«Ø§Ù„ 1: Ø§Ø´ØªØ±Ø§Ùƒ Ø£Ø³Ø¨ÙˆØ¹ÙŠ ÙƒØ§Ù…Ù„

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /api/financial/create-subscription
{
  advertiser_id: "ADV-TECH-001",
  plan_id: "cNAPAWGoSre3XRMnL1N5",  // Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
  start_date: "2025-11-22",
  vat_percentage: 15
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Advertiser (Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹)
{
  id: "ADV-TECH-001",
  business_name: "Ø´Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©",
  status: "active"
}

// Plan (Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹)
{
  id: "cNAPAWGoSre3XRMnL1N5",
  name: "Ø¨Ø§Ù‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",
  price: 400,
  duration_days: 7
}

// Subscription (Ø¬Ø¯ÙŠØ¯ âœ¨)
{
  id: "SUB-2025-001",
  advertiser_id: "ADV-TECH-001",
  plan_id: "cNAPAWGoSre3XRMnL1N5",
  start_date: "2025-11-22",
  end_date: "2025-11-29",        // +7 Ø£ÙŠØ§Ù…
  base_price: 400,
  total_amount: 460,             // 400 + VAT(60)
  paid_amount: 0,
  remaining_amount: 460,
  status: "active",
  payment_status: "pending"
}

// Invoice (Ø¬Ø¯ÙŠØ¯ âœ¨)
{
  id: "INV-2025-001",
  subscription_id: "SUB-2025-001",
  invoice_number: "INV-2025-001",
  subtotal: 400,
  vat_percentage: 15,
  vat_amount: 60,
  amount: 460,
  status: "unpaid",
  issued_date: "2025-11-22",
  due_date: "2025-11-29"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø®Ø·ÙˆØ© 2: ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /api/financial/record-payment
{
  subscription_id: "SUB-2025-001",
  invoice_id: "INV-2025-001",
  amount: 460,
  payment_method: "credit_card",
  payment_date: "2025-11-22"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Payment (Ø¬Ø¯ÙŠØ¯ âœ¨)
{
  id: "PAY-2025-001",
  subscription_id: "SUB-2025-001",
  invoice_id: "INV-2025-001",
  amount: 460,
  payment_date: "2025-11-22",
  payment_method: "credit_card"
}

// Subscription (Ù…Ø­Ø¯Ø« âœ…)
{
  id: "SUB-2025-001",
  paid_amount: 460,              // ÙƒØ§Ù† 0
  remaining_amount: 0,           // ÙƒØ§Ù† 460
  payment_status: "paid"         // ÙƒØ§Ù† pending
}

// Invoice (Ù…Ø­Ø¯Ø« âœ…)
{
  id: "INV-2025-001",
  status: "paid",                // ÙƒØ§Ù† unpaid
  paid_date: "2025-11-22"        // Ø¬Ø¯ÙŠØ¯
}

// AuditLog (Ø¬Ø¯ÙŠØ¯ âœ¨)
{
  entity_type: "invoice",
  entity_id: "INV-2025-001",
  action: "payment_recorded",
  changes: {
    old_status: "unpaid",
    new_status: "paid",
    amount: 460
  }
}
```

### Ù…Ø«Ø§Ù„ 2: Ø§Ø´ØªØ±Ø§Ùƒ Ø´Ù‡Ø±ÙŠ Ù…Ø¹ Ø®ØµÙ… ÙˆØ¯ÙØ¹Ø© Ø¬Ø²Ø¦ÙŠØ©

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¹ Ø®ØµÙ… 10%
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /api/financial/create-subscription
{
  advertiser_id: "ADV-MARKET-002",
  plan_id: "xAXqTLInisLuglofuQkH",  // Ø´Ù‡Ø±ÙŠØ©
  start_date: "2025-11-22",
  discount_type: "percentage",
  discount_amount: 10,
  initial_payment: 500,              // Ø¯ÙØ¹Ø© Ø£ÙˆÙ„ÙŠØ©
  payment_method: "bank_transfer",
  vat_percentage: 15
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

base_price:    1500 Ø±ÙŠØ§Ù„
discount(10%): -150 Ø±ÙŠØ§Ù„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
subtotal:      1350 Ø±ÙŠØ§Ù„
VAT (15%):     +202.5 Ø±ÙŠØ§Ù„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
total:         1552.5 Ø±ÙŠØ§Ù„
paid:          -500 Ø±ÙŠØ§Ù„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
remaining:     1052.5 Ø±ÙŠØ§Ù„

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ù†ØªÙŠØ¬Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Subscription
{
  id: "SUB-2025-002",
  advertiser_id: "ADV-MARKET-002",
  plan_id: "xAXqTLInisLuglofuQkH",
  start_date: "2025-11-22",
  end_date: "2025-12-22",          // +30 ÙŠÙˆÙ…
  base_price: 1500,
  discount_type: "percentage",
  discount_amount: 10,
  total_amount: 1552.5,
  paid_amount: 500,
  remaining_amount: 1052.5,
  status: "active",
  payment_status: "partial"        // Ù„Ø£Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø¬Ø²Ø¦ÙŠ
}

// Invoice
{
  id: "INV-2025-002",
  subscription_id: "SUB-2025-002",
  invoice_number: "INV-2025-002",
  subtotal: 1350,                  // Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
  vat_percentage: 15,
  vat_amount: 202.5,
  amount: 1552.5,
  status: "unpaid",                // Ù„Ø£Ù† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ > 0
  issued_date: "2025-11-22",
  due_date: "2025-12-22"
}

// Payment (Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©)
{
  id: "PAY-2025-002",
  subscription_id: "SUB-2025-002",
  invoice_id: "INV-2025-002",
  amount: 500,
  payment_date: "2025-11-22",
  payment_method: "bank_transfer",
  notes: "Ø¯ÙØ¹Ø© Ø£ÙˆÙ„ÙŠØ©"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /api/financial/record-payment
{
  subscription_id: "SUB-2025-002",
  invoice_id: "INV-2025-002",
  amount: 1052.5,
  payment_method: "cash",
  payment_date: "2025-11-29",
  notes: "Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Subscription (Ù…Ø­Ø¯Ø«)
{
  paid_amount: 1552.5,             // 500 + 1052.5
  remaining_amount: 0,
  payment_status: "paid"           // ØªÙ… Ø§Ù„Ø¯ÙØ¹ ÙƒØ§Ù…Ù„Ø§Ù‹ âœ…
}

// Invoice (Ù…Ø­Ø¯Ø«)
{
  status: "paid",                  // ØªÙ… Ø§Ù„Ø¯ÙØ¹ âœ…
  paid_date: "2025-11-29"
}

// Payment (Ø¬Ø¯ÙŠØ¯)
{
  id: "PAY-2025-003",
  amount: 1052.5,
  payment_date: "2025-11-29",
  payment_method: "cash",
  notes: "Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ"
}
```

### Ù…Ø«Ø§Ù„ 3: Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ù†ÙˆÙŠ - Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ÙƒØ§Ù…Ù„

```typescript
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Advertiser: "ADV-CORP-003" - "Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ø£Ù…Ù„ Ø§Ù„ÙƒØ¨Ø±Ù‰"
Plan: "wrwle7qvQbpUqm8QzToT" - "Ø¨Ø§Ù‚Ø© Ø³Ù†ÙˆÙŠØ©"
Price: 14,000 Ø±ÙŠØ§Ù„
Duration: 365 ÙŠÙˆÙ…

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

POST /api/financial/create-subscription
{
  advertiser_id: "ADV-CORP-003",
  plan_id: "wrwle7qvQbpUqm8QzToT",
  start_date: "2025-11-22",
  vat_percentage: 15
}

// Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª:
base: 14,000
VAT:  +2,100 (15%)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
total: 16,100 Ø±ÙŠØ§Ù„

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø§Ù„Ù†ØªÙŠØ¬Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Subscription: {
  id: "SUB-2025-003",
  start_date: "2025-11-22",
  end_date: "2026-11-22",          // Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©!
  base_price: 14000,
  total_amount: 16100,
  status: "active",
  payment_status: "pending"
}

Invoice: {
  id: "INV-2025-003",
  invoice_number: "INV-2025-003",
  subtotal: 14000,
  vat_amount: 2100,
  amount: 16100,
  status: "unpaid",
  due_date: "2026-11-22"
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„Ø¯ÙØ¹: 4 Ø¯ÙØ¹Ø§Øª Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Ø§Ù„Ø¯ÙØ¹Ø© 1: 22 Ù†ÙˆÙÙ…Ø¨Ø± 2025
POST /api/financial/record-payment
{ amount: 4025, payment_date: "2025-11-22" }
// âœ payment_status: "partial" (4025 / 16100)

// Ø§Ù„Ø¯ÙØ¹Ø© 2: 22 ÙØ¨Ø±Ø§ÙŠØ± 2026
POST /api/financial/record-payment
{ amount: 4025, payment_date: "2026-02-22" }
// âœ payment_status: "partial" (8050 / 16100)

// Ø§Ù„Ø¯ÙØ¹Ø© 3: 22 Ù…Ø§ÙŠÙˆ 2026
POST /api/financial/record-payment
{ amount: 4025, payment_date: "2026-05-22" }
// âœ payment_status: "partial" (12075 / 16100)

// Ø§Ù„Ø¯ÙØ¹Ø© 4: 22 Ø£ØºØ³Ø·Ø³ 2026
POST /api/financial/record-payment
{ amount: 4025, payment_date: "2026-08-22" }
// âœ payment_status: "paid" âœ… (16100 / 16100)

// Invoice.status: "paid" âœ…
// Invoice.paid_date: "2026-08-22"
```

---

## ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             COMPLETE INTEGRATION                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. ADVERTISER â†â†’ PLAN
   â€¢ Ø§Ù„Ù…Ø¹Ù„Ù† ÙŠØ®ØªØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø©
   â€¢ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: 400 (Ø£Ø³Ø¨ÙˆØ¹), 1500 (Ø´Ù‡Ø±)

2. PLAN â†’ SUBSCRIPTION
   â€¢ Ø§Ù„Ø³Ø¹Ø± (price) ÙŠÙ†Ø³Ø® Ø¥Ù„Ù‰ base_price
   â€¢ Ø§Ù„Ù…Ø¯Ø© (duration_days) ØªØ­Ø¯Ø¯ end_date
   â€¢ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„Ø¨Ø§Ù‚Ø©

3. SUBSCRIPTION â†’ INVOICE
   â€¢ ÙƒÙ„ Ø§Ø´ØªØ±Ø§Ùƒ = ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© (ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
   â€¢ subtotal = base_price - discount
   â€¢ VAT = 15% ÙŠÙØ¶Ø§Ù ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
   â€¢ amount = subtotal + VAT

4. INVOICE â† PAYMENT
   â€¢ ÙƒÙ„ Ø¯ÙØ¹Ø© ØªÙØ³Ø¬Ù„ ÙÙŠ payments
   â€¢ Ø§Ù„Ø¯ÙØ¹Ø§Øª ØªÙØ­Ø¯Ù‘Ø« Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø©
   â€¢ paid_amount ÙŠØ²ÙŠØ¯
   â€¢ remaining_amount ÙŠÙ†Ù‚Øµ

5. ALL â†’ AUDIT
   â€¢ ÙƒÙ„ ØªØºÙŠÙŠØ± ÙŠÙØ³Ø¬Ù„ ÙÙŠ audit_logs
   â€¢ ØªØªØ¨Ø¹ ÙƒØ§Ù…Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª

6. TIME â†’ STATUS UPDATE
   â€¢ Cloud Functions ØªÙØ­Øµ ÙŠÙˆÙ…ÙŠØ§Ù‹
   â€¢ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ© ØªØªØ­ÙˆÙ„ Ù„Ù€ expired
   â€¢ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØªØ±Ø³Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```

---

## âœ… Checklist Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„

### Firebase

- [x] âœ… Collection: `plans` (7 Ø¨Ø§Ù‚Ø§Øª)
- [x] âœ… Collection: `advertisers`
- [x] âœ… Collection: `subscriptions`
- [x] âœ… Collection: `invoices`
- [x] âœ… Collection: `payments`
- [x] âœ… Collection: `audit_logs`

### Services

- [x] âœ… `PlanService` - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª
- [x] âœ… `AdvertiserService` - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†
- [x] âœ… `SubscriptionService` - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
- [x] âœ… `InvoiceService` - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±
- [x] âœ… `PaymentService` - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
- [x] âœ… `FinancialService` - Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
- [x] âœ… `AuditService` - Ø³Ø¬Ù„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚

### API Endpoints

- [x] âœ… `GET /api/plans`
- [x] âœ… `POST /api/financial/create-subscription`
- [x] âœ… `POST /api/financial/record-payment`
- [x] âœ… `GET /api/financial/advertiser-summary/:id`
- [x] âœ… `GET /api/invoices`
- [x] âœ… `GET /api/invoices/:id`

### Features

- [x] âœ… VAT Calculation (15%)
- [x] âœ… Discount System (amount/percentage)
- [x] âœ… Payment Status Tracking
- [x] âœ… Auto Invoice Generation
- [x] âœ… Auto Status Updates
- [x] âœ… Audit Trail
- [x] âœ… Date Management
- [x] âœ… Pricing Integration

---

## ğŸš€ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†

```bash
# 1. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Firebase
node scripts/add-plans.js

# 2. Ø´ØºÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
npm run dev

# 3. Ø§ÙØªØ­ Dashboard
open http://localhost:3000/admin/dashboard

# 4. Ø£Ù†Ø´Ø¦ Ø§Ø´ØªØ±Ø§Ùƒ ØªØ¬Ø±ÙŠØ¨ÙŠ
â€¢ Ø§Ø®ØªØ± Ù…Ø¹Ù„Ù†
â€¢ Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø© (Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
â€¢ Ø´Ø§Ù‡Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙÙ†Ø´Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
â€¢ Ø³Ø¬Ù„ Ø¯ÙØ¹Ø©
â€¢ Ø´Ø§Ù‡Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
```

---

**ğŸ‰ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…ØªÙƒØ§Ù…Ù„ 100% Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©!**

- âœ… Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø­Ø¯Ø«Ø©
- âœ… Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø³Ù„ÙŠÙ…Ø©
- âœ… VAT Ù…Ø­Ø³ÙˆØ¨ ØµØ­ÙŠØ­
- âœ… Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚ ÙŠØ¹Ù…Ù„
- âœ… ÙƒÙ„ Ø´ÙŠØ¡ Ù…ÙØ®ØªØ¨Ø±

**ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«:** 22 Ù†ÙˆÙÙ…Ø¨Ø± 2025

