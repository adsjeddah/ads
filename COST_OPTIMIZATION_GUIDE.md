# دليل تحسين التكلفة للاستخدام المجاني لنظام إعلانات جدة

هذا الدليل يوضح كيفية استخدام كامل وظائف النظام ضمن الحدود المجانية لـ Vercel و Firebase.

## الحدود المجانية

### Firebase (الخطة المجانية - Spark):
- **Firestore**: 1GB تخزين + 50,000 قراءة + 20,000 كتابة + 20,000 حذف يوميًا
- **Authentication**: حتى 50,000 مستخدم مسجل
- **Storage**: 5GB تخزين + 1GB تنزيل يوميًا
- **Cloud Functions**: غير متاح في الخطة المجانية (نستخدم API Routes من Vercel بدلًا منها)

### Vercel (الخطة الهواة - Hobby):
- **حركة المرور**: 100GB شهريًا
- **الاستضافة**: بناء مستمر مع مجال فرعي مجاني
- **Serverless Functions (API Routes)**: 12 ساعة تنفيذ شهريًا
- **النشر**: عدد غير محدود من النشر التلقائي

## استراتيجيات تحسين الاستخدام

### 1. تحسين استخدام Firestore:

#### تقليل عمليات القراءة:
- تم تنفيذ التخزين المؤقت للبيانات المتكررة الاستخدام (advertisers, plans)
- استخدم `where` و `limit` في الاستعلامات للحصول على البيانات المطلوبة فقط
- جلب حقول محددة بدلاً من المستندات كاملة عند الإمكان
- تجنب الاستعلامات المتكررة نفس البيانات

#### تقليل عمليات الكتابة:
- تجميع التحديثات المتعددة في عملية واحدة
- تنفيذ التحقق من التغييرات قبل الحفظ (لا تحفظ إذا لم تتغير البيانات)
- استخدم عمليات الدُفعة (batch operations) للتحديثات المتعددة

### 2. تحسين Firebase Storage:

- ضغط الصور قبل الرفع للحفاظ على مساحة التخزين
- استخدام التخزين المؤقت للصور في الواجهة الأمامية
- تحديد حجم أقصى للملفات (مثلاً 1MB للصور)

### 3. تحسين Firebase Authentication:

- تم تنفيذ التخزين المؤقت للتوكن للحد من عمليات التحقق المتكررة
- استخدام التخزين المحلي (localStorage) لحفظ حالة تسجيل الدخول

### 4. تحسين API Routes في Vercel:

- تصميم API للحد من عدد الطلبات المطلوبة
- استخدام ISR (Incremental Static Regeneration) للصفحات التي تتغير قليلاً
- تجنب سلاسل استدعاءات API المتتالية

## التنفيذ العملي

### الاستضافة مع Vercel:

1. **تسجيل حساب Vercel**: https://vercel.com/signup
2. **ربط مستودع GitHub**: اتبع التعليمات في واجهة Vercel
3. **ضبط متغيرات البيئة**:
   - انسخ جميع متغيرات Firebase من ملف `.env.local`
   - أضفها في إعدادات المشروع على Vercel

### استخدام Firebase ضمن الحدود المجانية:

1. **مراقبة الاستخدام**:
   - تحقق بانتظام من لوحة تحكم Firebase لمراقبة استخدام الموارد
   - قم بإعداد تنبيهات الاستخدام في Firebase

2. **التعامل مع المستخدمين**:
   - إبقاء عدد المعلنين والفواتير ضمن الحدود المعقولة
   - تنظيف البيانات القديمة بانتظام

## مراقبة الأداء والاستخدام

لمراقبة استخدام Firebase، استخدم الأداة التالية:

```javascript
// أضف هذا في ملف pages/_app.tsx
import { useEffect } from 'react';
import firebase from 'firebase/app';

function MyApp({ Component, pageProps }) {
  useEffect(() => {
    // إضافة مراقبة الاستخدام في بيئة التطوير فقط
    if (process.env.NODE_ENV === 'development') {
      firebase.firestore().settings({
        ignoreUndefinedProperties: true,
      });
      
      // تمكين مراقبة استخدام Firestore في وحدة التحكم
      firebase.firestore.setLogLevel('debug');
    }
  }, []);
  
  return <Component {...pageProps} />;
}

export default MyApp;
```

## الخلاصة

باتباع هذه الإرشادات، يمكنك استخدام نظام إدارة المعلنين والفواتير بالكامل ضمن الحدود المجانية لـ Firebase و Vercel، مع الحفاظ على أداء جيد وتجربة مستخدم سلسة.

إذا زاد استخدامك عن الحدود المجانية، فكر في:
1. تنفيذ المزيد من تقنيات التخزين المؤقت
2. تبسيط العمليات وتقليل طلبات البيانات
3. الترقية إلى خطة مدفوعة إذا تجاوز المشروع الحدود المجانية بشكل مستمر 