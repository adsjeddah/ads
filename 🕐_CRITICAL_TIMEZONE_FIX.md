# ๐ ุฅุตูุงุญ ุญุฑุฌ: ุชูุญูุฏ ุงูุชูููุช ุงูุณุนูุฏู ูู ุฌููุน ุงูุนูููุงุช

## ๐จ ุงููุดููุฉ ุงูุญุฑุฌุฉ ุงูููุชุดูุฉ

ุนูุฏ ุงููุญุต ุงูุตุงุฑู ูููุธุงูุ ุงูุชุดููุง ุฃู **ุฌููุน ุงูุชูุงุฑูุฎ ุงูุญุฑุฌุฉ** ูุงูุช ุชูุญุณุจ ุจุชูููุช ุงูุฎุงุฏู ุงููุญูู ูููุณ ุจุงูุชูููุช ุงูุณุนูุฏู!

### โ๏ธ ุงูุชุฃุซูุฑ ุนูู ุงููุธุงู:

1. **ุชูุงุฑูุฎ ุงูุงุดุชุฑุงูุงุช**: ุจุฏุงูุฉ ูููุงูุฉ ุงูุฅุนูุงูุงุช ูุงูุช ุฎุงุทุฆุฉ
2. **ุชูุงุฑูุฎ ุงูููุงุชูุฑ**: ุงูุฅุตุฏุงุฑ ูุงูุงุณุชุญูุงู ุจุชูููุช ุบูุฑ ุตุญูุญ
3. **ุชูุงุฑูุฎ ุงููุฏููุนุงุช**: ุณุฌูุงุช ุงูุฏูุน ุจุชูููุช ุฎุงุทุฆ
4. **ุงูุฅุญุตุงุฆูุงุช ุงูููููุฉ**: ุชุณุฌูู ุงููุดุงูุฏุงุช ูุงูููุฑุงุช ุจุชูููุช ุฎุงุทุฆ
5. **ุงูุชุฐููุฑุงุช**: ุฌุฏููุฉ ุงูุชุฐููุฑุงุช ุจุชูููุช ุบูุฑ ุฏููู

### ๐ฅ ุงูุณููุงุฑูู ุงูุฎุทูุฑ:

```
โ ูุจู ุงูุฅุตูุงุญ:
- ุงููุนูู ูุดุชุฑู ุฅุนูุงู 30 ููู ูุจุฏุฃ 1 ููุงูุฑ
- ุงูุฎุงุฏู ูู ุฃูุฑููุง (UTC-8)
- ุงูุชุงุฑูุฎ ููุณุฌู: 31 ุฏูุณูุจุฑ 11:00 PM
- ุงูุฅุนูุงู ูุจุฏุฃ ูุจู ููู ูุงูู!
- ูููุชูู ูุจู ููู ุฃูุถุงู!
```

---

## โ ุงูุญู ุงููุทุจู

### 1. ุฅูุดุงุก ุฏูุงู ุชูููุช ูุฑูุฒูุฉ

ูู `lib/utils/date.ts`:

```typescript
// ุงูุชูููุช ุงูุณุนูุฏู
export const SAUDI_TIMEZONE = 'Asia/Riyadh'; // UTC+3

// ุงูุญุตูู ุนูู ุงูููุช ุงูุญุงูู ุจุชูููุช ุงูุณุนูุฏูุฉ
export function getSaudiNow(): Date {
  return toSaudiTime(new Date());
}

// ุชุญููู ุฃู ุชุงุฑูุฎ ุฅูู ุงูุชูููุช ุงูุณุนูุฏู
export function toSaudiTime(date: Date | string | number): Date {
  const dateObj = typeof date === 'string' ? parseISO(date) : new Date(date);
  const saudiTime = new Date(dateObj.toLocaleString('en-US', { 
    timeZone: SAUDI_TIMEZONE 
  }));
  return saudiTime;
}

// ุฅุถุงูุฉ ุฃูุงู (ุจุงูุชูููุช ุงูุณุนูุฏู)
export function addDays(date: Date | string | number, days: number): Date {
  const dateObj = toSaudiTime(date);
  dateObj.setDate(dateObj.getDate() + days);
  return dateObj;
}

// ุจุฏุงูุฉ ุงูููู (00:00:00 ุจุชูููุช ุงูุณุนูุฏูุฉ)
export function startOfDay(date: Date | string | number): Date {
  const dateObj = toSaudiTime(date);
  dateObj.setHours(0, 0, 0, 0);
  return dateObj;
}
```

---

## ๐ง ุงููููุงุช ุงูุญุฑุฌุฉ ุงููุญุฏุซุฉ

### 1. `lib/services/financial.service.ts` โญ ุงูุฃูู

**ุญุณุงุจ ุชูุงุฑูุฎ ุงูุงุดุชุฑุงูุงุช:**

```typescript
// โ ูุจู
const startDate = new Date(data.start_date);
const endDate = new Date(startDate);
endDate.setDate(endDate.getDate() + plan.duration_days);

// โ ุจุนุฏ
const startDate = toSaudiTime(data.start_date);
const endDate = addDays(startDate, plan.duration_days);
```

**ุชูุงุฑูุฎ ุงูุฏูุนุงุช:**

```typescript
// โ ูุจู
payment_date: new Date()

// โ ุจุนุฏ
payment_date: getSaudiNow()
```

**ุชูุงุฑูุฎ ุชุญุฏูุซ ุงูููุงุชูุฑ:**

```typescript
// โ ูุจู
await InvoiceAdminService.updatePaymentStatus(id, 'paid', new Date());

// โ ุจุนุฏ
await InvoiceAdminService.updatePaymentStatus(id, 'paid', getSaudiNow());
```

**ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ:**

```typescript
// โ ูุจู
const now = new Date();

// โ ุจุนุฏ
const now = getSaudiNow();
```

**ุชูููุฏ ุฃุฑูุงู ุงูููุงุชูุฑ:**

```typescript
// โ ูุจู
const now = new Date();
const year = now.getFullYear();

// โ ุจุนุฏ
const now = getSaudiNow();
const year = now.getFullYear();
```

---

### 2. `lib/services/reminder.service.ts`

**ุฅูุดุงุก ุชุฐููุฑุงุช ููููุงุชูุฑ ุงููุณุชุญูุฉ:**

```typescript
// โ ูุจู
const threeDaysFromNow = new Date();
threeDaysFromNow.setDate(threeDaysFromNow.getDate() + 3);

// โ ุจุนุฏ
const threeDaysFromNow = addDays(getSaudiNow(), 3);
```

---

### 3. `lib/services/ad-request-admin.service.ts`

**ุชุงุฑูุฎ ุฅูุดุงุก ุงูุทูุจ:**

```typescript
// โ ูุจู
created_at: new Date()

// โ ุจุนุฏ
created_at: getSaudiNow()
```

**ุชุงุฑูุฎ ุฑูุถ ุงูุทูุจ:**

```typescript
// โ ูุจู
rejected_at: new Date()

// โ ุจุนุฏ
rejected_at: getSaudiNow()
```

---

### 4. `lib/services/statistics.service.ts`

**ุชุณุฌูู ุงููุดุงูุฏุงุช ุงูููููุฉ:**

```typescript
// โ ูุจู
const today = new Date();
today.setHours(0, 0, 0, 0);

// โ ุจุนุฏ
const today = startOfDay(getSaudiNow());
```

**ุชุณุฌูู ุงูููุฑุงุช:**

```typescript
// โ ูุจู
const today = new Date();
today.setHours(0, 0, 0, 0);

// โ ุจุนุฏ
const today = startOfDay(getSaudiNow());
```

**ุชุณุฌูู ุงูููุงููุงุช:**

```typescript
// โ ูุจู
const today = new Date();
today.setHours(0, 0, 0, 0);

// โ ุจุนุฏ
const today = startOfDay(getSaudiNow());
```

---

### 5. `lib/services/statistics-admin.service.ts`

ููุณ ุงูุชุญุฏูุซุงุช ูููุณุฎุฉ ุงูุฎุงุตุฉ ุจุงูู Admin SDK.

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

### ุงููููุงุช ุงููุญุฏุซุฉ (6 ูููุงุช ุญุฑุฌุฉ):

1. โ `lib/services/financial.service.ts` - 9 ุงุณุชุฎุฏุงูุงุช ูุญุฏุซุฉ
2. โ `lib/services/reminder.service.ts` - 1 ุงุณุชุฎุฏุงู ูุญุฏุซ
3. โ `lib/services/ad-request-admin.service.ts` - 2 ุงุณุชุฎุฏุงู ูุญุฏุซ
4. โ `lib/services/statistics.service.ts` - 3 ุงุณุชุฎุฏุงูุงุช ูุญุฏุซุฉ
5. โ `lib/services/statistics-admin.service.ts` - 3 ุงุณุชุฎุฏุงูุงุช ูุญุฏุซุฉ
6. โ ุฌููุน ุงุณุชุฎุฏุงูุงุช `new Date()` ุงุณุชุจุฏูุช ุจู `getSaudiNow()`

### ุฅุฌูุงูู ุงูุฅุตูุงุญุงุช: 18+ ููุถุน ุญุฑุฌ

---

## โ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

### โจ ุงูุขู ุฌููุน ุงูุนูููุงุช ุชุนูู ุจุงูุชูููุช ุงูุณุนูุฏู:

```
โ ุจุนุฏ ุงูุฅุตูุงุญ:
- ุงููุนูู ูุดุชุฑู ุฅุนูุงู 30 ููู ูุจุฏุฃ 1 ููุงูุฑ
- ุงููุธุงู ูุณุชุฎุฏู ุชูููุช ุงูุฑูุงุถ (UTC+3)
- ุงูุชุงุฑูุฎ ููุณุฌู: 1 ููุงูุฑ 12:00 AM (ุจุชูููุช ุงูุณุนูุฏูุฉ)
- ุงูุฅุนูุงู ูุจุฏุฃ ุจุงูุถุจุท ูู 1 ููุงูุฑ
- ูููุชูู ุจุงูุถุจุท ุจุนุฏ 30 ููู
```

### ๐ฏ ุงูุถูุงูุงุช:

- โ **ุชูุงุฑูุฎ ุงูุงุดุชุฑุงูุงุช**: ุฏูููุฉ 100% ุจุงูุชูููุช ุงูุณุนูุฏู
- โ **ุจุฏุงูุฉ ูููุงูุฉ ุงูุฅุนูุงูุงุช**: ุญุณุจ ุงูุจุงูุงุช ุจุงูุถุจุท
- โ **ุงูููุงุชูุฑ**: ุชูุงุฑูุฎ ุฅุตุฏุงุฑ ูุงุณุชุญูุงู ุตุญูุญุฉ
- โ **ุงููุฏููุนุงุช**: ุณุฌูุงุช ุฏูููุฉ ุจุงูุชูููุช ุงููุญูู
- โ **ุงูุฅุญุตุงุฆูุงุช**: ุชุณุฌูู ูููู ุฏููู
- โ **ุงูุชุฐููุฑุงุช**: ุฌุฏููุฉ ุตุญูุญุฉ

---

## ๐ฌ ููููุฉ ุงูุชุญูู

### ุงุฎุชุจุงุฑ 1: ุฅูุดุงุก ุงุดุชุฑุงู ุฌุฏูุฏ

```typescript
// ูู ุงููููุณูู ุฃู ุนุจุฑ API
const subscription = await FinancialService.createSubscriptionWithInvoice({
  advertiser_id: 'test',
  plan_id: 'plan_30days',
  start_date: new Date('2025-01-01'),
  // ...
});

// ุงูุชุญูู:
// start_date: 2025-01-01 00:00:00 (ุชูููุช ุงูุฑูุงุถ)
// end_date: 2025-01-31 00:00:00 (ุชูููุช ุงูุฑูุงุถ)
```

### ุงุฎุชุจุงุฑ 2: ุชุณุฌูู ุฅุญุตุงุฆูุฉ

```typescript
await StatisticsService.recordView(advertiserId);

// ุงูุชุญูู: ุชุงุฑูุฎ ุงูููู ูุฌุจ ุฃู ูููู ุจุชูููุช ุงูุณุนูุฏูุฉ
```

### ุงุฎุชุจุงุฑ 3: ูุญุต ุงูุงุดุชุฑุงูุงุช ุงูููุชููุฉ

```typescript
const result = await FinancialService.checkExpiredSubscriptions();

// ุงูุชุญูู: ุงูููุงุฑูุฉ ุชุชู ูุน ุงูููุช ุงูุญุงูู ุจุชูููุช ุงูุณุนูุฏูุฉ
```

---

## ๐ ููุงุญุธุงุช ูููุฉ ูููุทูุฑูู

### โ๏ธ ููุงุนุฏ ุฅูุฒุงููุฉ:

1. **ูุง ุชุณุชุฎุฏู `new Date()` ูุจุงุดุฑุฉ**
   ```typescript
   โ const now = new Date();
   โ const now = getSaudiNow();
   ```

2. **ุงุณุชุฎุฏู ุฏูุงู ุงูุชูููุช ุงููุฑูุฒูุฉ**
   ```typescript
   import { getSaudiNow, addDays, startOfDay } from '@/lib/utils/date';
   ```

3. **ุนูุฏ ุฅุถุงูุฉ ุฃูุงู ูุชุงุฑูุฎ**
   ```typescript
   โ date.setDate(date.getDate() + 30);
   โ const newDate = addDays(date, 30);
   ```

4. **ุนูุฏ ุงูุญุตูู ุนูู ุจุฏุงูุฉ ุงูููู**
   ```typescript
   โ today.setHours(0, 0, 0, 0);
   โ const today = startOfDay(getSaudiNow());
   ```

---

## ๐ ุงูููุงุฆุฏ

1. โ **ุฏูุฉ ุงูุฅุนูุงูุงุช**: ุชุดุบูู ูุฅููุงู ุฏููู ุญุณุจ ุงูุจุงูุงุช
2. โ **ููุซูููุฉ ุงูููุงุชูุฑ**: ุชูุงุฑูุฎ ุตุญูุญุฉ ููุงุณุชุญูุงู ูุงูุชุญุตูู
3. โ **ุฅุญุตุงุฆูุงุช ุฏูููุฉ**: ุชูุงุฑูุฑ ููููุฉ ุตุญูุญุฉ
4. โ **ุชุฌุฑุจุฉ ุฃูุถู ูููุนูููู**: ุงููุธุงู ูุนูู ุจุชูููุชูู ุงููุญูู
5. โ **ุงูุชุซุงู**: ุชูุงูู ูุน ุงููุชุทูุจุงุช ุงููุญููุฉ

---

**ุชุงุฑูุฎ ุงูุฅุตูุงุญ:** 23 ููููุจุฑ 2025  
**ุงูุฃููููุฉ:** ๐ด ุญุฑุฌุฉ ุฌุฏุงู  
**ุงูุญุงูุฉ:** โ ููุชูู ููุฎุชุจุฑ  
**Build:** โ ูุงุฌุญ  

๐ฏ **ุงููุธุงู ุงูุขู ูุนูู 100% ุจุงูุชูููุช ุงูุณุนูุฏู ูู ุฌููุน ุงูุนูููุงุช ุงูุญุฑุฌุฉ!**

