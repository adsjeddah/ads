# ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„: Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„
## Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙˆØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚

---

## ğŸ“‘ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª

1. [Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…](#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©)
2. [Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©](#Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ©-Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
3. [ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©](#ØªØ­Ù„ÙŠÙ„-Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª)
4. [Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ©](#Ù†Ù‚Ø§Ø·-Ø§Ù„Ù‚ÙˆØ©)
5. [Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ø«ØºØ±Ø§Øª](#Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª-ÙˆØ§Ù„Ø«ØºØ±Ø§Øª)
6. [Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©](#Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª-Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©)
7. [Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ°](#Ø®Ø·Ø©-Ø§Ù„ØªÙ†ÙÙŠØ°)
8. [Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø¶Ù…Ø§Ù†](#Ù…Ø¹Ø§ÙŠÙŠØ±-Ø§Ù„Ø¬ÙˆØ¯Ø©)

---

## ğŸ¯ Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… {#Ù†Ø¸Ø±Ø©-Ø¹Ø§Ù…Ø©}

### Ø§Ù„ÙˆØµÙ
Ù†Ø¸Ø§Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ù‡Ùˆ Ø¬Ø²Ø¡ Ù…Ø­ÙˆØ±ÙŠ Ù…Ù† Ù…Ù†ØµØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§ØªØŒ Ù…Ø±ØªØ¨Ø· Ø¨Ø´ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹:
- **Ø§Ù„Ø¨Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ©** (Plans): 6 Ø¨Ø§Ù‚Ø§Øª Ø¨Ù…Ø¯Ø¯ Ù…Ø®ØªÙ„ÙØ© (15 ÙŠÙˆÙ… â†’ Ø³Ù†Ø©)
- **Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª** (Subscriptions): ÙØªØ±Ø© Ø²Ù…Ù†ÙŠØ© Ù…Ø­Ø¯Ø¯Ø© Ù„Ù…Ø¹Ù„Ù† ÙÙŠ Ø¨Ø§Ù‚Ø© Ù…Ø¹ÙŠÙ†Ø©
- **Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª** (Payments): Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø¬Ù„Ø©
- **Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ†** (Advertisers): Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø°ÙŠÙ† ÙŠØ´ØªØ±ÙˆÙ† Ø§Ù„Ø¨Ø§Ù‚Ø§Øª

### Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
Ø¶Ù…Ø§Ù† Ø¯Ù‚Ø© ÙˆØ´ÙØ§ÙÙŠØ© ÙƒØ§Ù…Ù„Ø© ÙÙŠ:
- âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
- âœ… ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª (Ù…Ø¯ÙÙˆØ¹/Ø¬Ø²Ø¦ÙŠ/Ù…Ø¹Ù„Ù‚)
- âœ… Ø±Ø¨Ø· Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
- âœ… Ø¥Ø¯Ø§Ø±Ø© ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ ÙˆØ§Ù„Ø¥ØµØ¯Ø§Ø±
- âœ… ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ© Ø¯Ù‚ÙŠÙ‚Ø©

---

## ğŸ—ï¸ Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ© {#Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ©-Ø§Ù„Ø­Ø§Ù„ÙŠØ©}

### 1. Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Data Models)

#### Invoice (Ø§Ù„ÙØ§ØªÙˆØ±Ø©)
```typescript
{
  id: string;                    // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
  subscription_id: string;       // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  invoice_number: string;        // Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© ÙØ±ÙŠØ¯ (INV-202411-0001)
  amount: number;                // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
  status: 'paid' | 'unpaid' | 'cancelled';
  issued_date: Date;             // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±
  due_date: Date;                // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚
  paid_date?: Date;              // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹ (Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙƒØ§Ù…Ù„)
  created_at: Date;              // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
}
```

#### Subscription (Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ)
```typescript
{
  id: string;
  advertiser_id: string;         // Ø§Ù„Ù…Ø¹Ù„Ù†
  plan_id: string;               // Ø§Ù„Ø¨Ø§Ù‚Ø©
  start_date: Date;              // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
  end_date: Date;                // ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ù…Ø­Ø³ÙˆØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
  base_price: number;            // Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù…Ù† Ø§Ù„Ø¨Ø§Ù‚Ø©
  discount_type: 'amount' | 'percentage';
  discount_amount: number;       // Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…
  total_amount: number;          // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…
  paid_amount: number;           // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
  remaining_amount: number;      // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
  status: 'active' | 'expired' | 'cancelled';
  payment_status: 'paid' | 'partial' | 'pending';
  created_at: Date;
}
```

#### Payment (Ø§Ù„Ø¯ÙØ¹Ø©)
```typescript
{
  id: string;
  subscription_id: string;       // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  invoice_id?: string;           // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  amount: number;                // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹
  payment_date: Date;            // ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯ÙØ¹
  payment_method?: string;       // Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (cash, bank, card)
  transaction_id?: string;       // Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø§Ù„Ù…ØµØ±ÙÙŠØ©
  notes?: string;                // Ù…Ù„Ø§Ø­Ø¸Ø§Øª
  created_at: Date;
}
```

---

### 2. Ø§Ù„Ø®Ø¯Ù…Ø§Øª (Services)

#### A. InvoiceAdminService
**Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ§Øª:**
```typescript
âœ… create(data)              // Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
âœ… getAll()                  // Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
âœ… getById(id)               // Ø¬Ù„Ø¨ ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø©
âœ… getBySubscriptionId(id)   // ÙÙˆØ§ØªÙŠØ± Ø§Ø´ØªØ±Ø§Ùƒ Ù…Ø¹ÙŠÙ†
âœ… update(id, data)          // ØªØ­Ø¯ÙŠØ« ÙØ§ØªÙˆØ±Ø©
âœ… updatePaymentStatus()     // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹
âœ… delete(id)                // Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø©
âœ… getUnpaidInvoices()       // Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
âœ… getOverdueInvoices()      // Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
```

**Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª:**
- âœ… ØªØºØ·ÙŠØ© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
- âœ… Ø¯ÙˆØ§Ù„ Ù…ØªØ®ØµØµØ© Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
- âœ… Ù…Ø¹Ø§Ù„Ø¬Ø© ØµØ­ÙŠØ­Ø© Ù„Ù€ Firestore Timestamps

**Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ­Ø³ÙŠÙ†:**
- âš ï¸ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ validation Ù…ØªÙ‚Ø¯Ù…Ø©
- âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯ÙˆØ§Ù„ Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©
- âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ audit trail Ù„Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª

---

#### B. FinancialService (Ø§Ù„Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø§Ø¨Ø¶ Ù„Ù„Ù†Ø¸Ø§Ù…)

**Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**

1. **calculateDiscount()** - Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø¨Ø¯Ù‚Ø©
   ```typescript
   âœ… Ø¯Ø¹Ù… Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© ÙˆØ§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø«Ø§Ø¨Øª
   âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
   âœ… Ù…Ù†Ø¹ Ø§Ù„Ø®ØµÙ… Ù…Ù† ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
   âœ… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†
   ```

2. **createSubscriptionWithInvoice()** - Ø¥Ù†Ø´Ø§Ø¡ Ù…ØªÙƒØ§Ù…Ù„
   ```typescript
   âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
   âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
   âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© (Ø¥Ù† ÙˆØ¬Ø¯Øª)
   âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
   âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø¨Ø´ÙƒÙ„ Ø°ÙƒÙŠ
   ```

3. **recordPayment()** - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø§Øª
   ```typescript
   âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¨Ù„Øº
   âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
   âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„
   âœ… Ø±Ø¨Ø· Ø§Ù„Ø¯ÙØ¹Ø© Ø¨Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©
   ```

4. **getAdvertiserFinancialSummary()** - Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ
   ```typescript
   âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
   âœ… Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø© ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø©
   âœ… Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„
   âœ… Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
   ```

5. **checkAndUpdateSubscriptionStatuses()** - Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ©
   ```typescript
   âœ… ÙØ­Øµ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
   âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
   âœ… Ø¥Ø±Ø¬Ø§Ø¹ ØªÙ‚Ø±ÙŠØ± Ø¨Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
   ```

6. **cancelSubscription()** - Ø§Ù„Ø¥Ù„ØºØ§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
   ```typescript
   âœ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
   âœ… Ø­Ø³Ø§Ø¨ Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
   âœ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
   ```

---

### 3. ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI)

#### A. ØµÙØ­Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (`/admin/invoices`)

**Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:**
```typescript
âœ… Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙÙŠ Ø¬Ø¯ÙˆÙ„
âœ… Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…/Ø§Ù„Ù‡Ø§ØªÙ/Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©
âœ… ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© (Ù…Ø¯ÙÙˆØ¹/Ø¬Ø²Ø¦ÙŠ/ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹)
âœ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ/Ø§Ù„Ù…Ø¯ÙÙˆØ¹/Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
âœ… Badges Ù…Ù„ÙˆÙ†Ø© Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ±
âœ… Ø±Ø§Ø¨Ø· Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
```

**Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:**
- âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ pagination (Ù…Ø´ÙƒÙ„Ø© Ù…Ø¹ Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„ÙÙˆØ§ØªÙŠØ±)
- âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®
- âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØµØ¯ÙŠØ± (PDF/Excel)
- âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©

---

#### B. ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (`/admin/invoices/[id]`)

**Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:**
```typescript
âœ… Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„ Ù„Ù„ÙØ§ØªÙˆØ±Ø© (Ø¬Ø§Ù‡Ø² Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©)
âœ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù† ÙˆØ§Ù„Ø§ØªØµØ§Ù„
âœ… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ§Ù„Ø®ØµÙˆÙ…Ø§Øª
âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº (Ø£Ø³Ø§Ø³ÙŠ/Ø®ØµÙ…/Ø¥Ø¬Ù…Ø§Ù„ÙŠ)
âœ… Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø©
âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
âœ… Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
```

**Ø§Ù„Ù…Ø´Ø§ÙƒÙ„:**
- âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©
- âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø± Ù„ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
- âš ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙƒØ§Ù…Ù„ Ù…Ø¹ WhatsApp/Email Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©

---

#### C. Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ø¹Ù„Ù† (`/admin/advertisers/[id]/financial`)

**Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:**
```typescript
âœ… Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ (FinancialSummaryCard)
âœ… Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯
âœ… Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©
âœ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù…Ø¹ Progress Bars
âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
âœ… Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„
âœ… ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù„Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
âœ… ØªØ­Ø¯ÙŠØ« Ù„Ø­Ø¸ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª
```

**Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ù…ØªØ§Ø²Ø©! âœ…**

---

### 4. API Endpoints

#### Ø§Ù„ÙÙˆØ§ØªÙŠØ±:
```typescript
GET    /api/invoices              // Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
GET    /api/invoices?subscriptionId=xxx  // ÙÙˆØ§ØªÙŠØ± Ø§Ø´ØªØ±Ø§Ùƒ
GET    /api/invoices/[id]         // ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø©
POST   /api/invoices              // Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©
PUT    /api/invoices/[id]         // ØªØ­Ø¯ÙŠØ« ÙØ§ØªÙˆØ±Ø©
DELETE /api/invoices/[id]         // Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø©
GET    /api/invoices/unpaid       // Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©
```

#### Ø§Ù„Ù…Ø§Ù„ÙŠØ©:
```typescript
POST   /api/financial/create-subscription     // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ + ÙØ§ØªÙˆØ±Ø©
POST   /api/financial/record-payment          // ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©
GET    /api/financial/advertiser-summary      // Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ
POST   /api/financial/check-subscriptions     // ÙØ­Øµ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
POST   /api/financial/cancel-subscription     // Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ
POST   /api/financial/calculate-discount      // Ø­Ø³Ø§Ø¨ Ø®ØµÙ…
```

---

## ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© {#ØªØ­Ù„ÙŠÙ„-Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª}

### 1. Ø¯ÙˆØ±Ø© Ø­ÙŠØ§Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ                              â”‚
â”‚                           â†“                                      â”‚
â”‚         FinancialService.createSubscriptionWithInvoice()        â”‚
â”‚                           â†“                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â†“                      â†“                      â†“              â”‚
â”‚ Subscription          Invoice               Payment (Ø£ÙˆÙ„ÙŠØ©)    â”‚
â”‚  - active            - unpaid               - Ù…Ø³Ø¬Ù„Ø©            â”‚
â”‚  - partial           - due_date             - Ù…Ø±Ø¨ÙˆØ·Ø©          â”‚
â”‚                           â†“                                      â”‚
â”‚              Ø¯ÙØ¹Ø§Øª Ø¬Ø²Ø¦ÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)                      â”‚
â”‚                           â†“                                      â”‚
â”‚         FinancialService.recordPayment()                        â”‚
â”‚                           â†“                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚    â†“                      â†“                      â†“              â”‚
â”‚ Subscription ØªØ­Ø¯ÙŠØ«   Invoice ØªØ­Ø¯ÙŠØ«        Payment Ø¬Ø¯ÙŠØ¯         â”‚
â”‚  - paid_amount++     - status              - Ù…Ø³Ø¬Ù„Ø©            â”‚
â”‚  - remaining--       - paid_date           - Ù…Ø±Ø¨ÙˆØ·Ø©           â”‚
â”‚                           â†“                                      â”‚
â”‚              Ø¹Ù†Ø¯ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„ÙƒØ§Ù…Ù„                                  â”‚
â”‚                           â†“                                      â”‚
â”‚    Subscription: paid  +  Invoice: paid  âœ…                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ ÙƒØ§Ù…Ù„: Ù…Ø¹Ù„Ù† Ø¬Ø¯ÙŠØ¯

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:
```
1ï¸âƒ£ Ø§Ù„Ù…Ø¹Ù„Ù† ÙŠØ·Ù„Ø¨ Ø¨Ø§Ù‚Ø© Ø´Ù‡Ø±ÙŠØ© (1000 Ø±ÙŠØ§Ù„)
   â†“
2ï¸âƒ£ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØªØ·Ø¨Ù‚ Ø®ØµÙ… 15% (Ø®ØµÙ… ØªØ±Ø­ÙŠØ¨ÙŠ)
   â†“ Ø­Ø³Ø§Ø¨: 1000 - (1000 * 15%) = 850 Ø±ÙŠØ§Ù„
   â†“
3ï¸âƒ£ Ø§Ù„Ù…Ø¹Ù„Ù† ÙŠØ¯ÙØ¹ 500 Ø±ÙŠØ§Ù„ ÙƒØ¯ÙØ¹Ø© Ø£ÙˆÙ„ÙŠØ©
   â†“
4ï¸âƒ£ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠÙ†Ø´Ø¦:
   ğŸ“„ Subscription {
      total_amount: 850,
      paid_amount: 500,
      remaining_amount: 350,
      payment_status: 'partial',
      status: 'active'
   }
   
   ğŸ§¾ Invoice {
      invoice_number: 'INV-202411-0045',
      amount: 850,
      status: 'unpaid',
      issued_date: Ø§Ù„ÙŠÙˆÙ…,
      due_date: Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø´Ù‡Ø±
   }
   
   ğŸ’° Payment {
      amount: 500,
      payment_method: 'cash',
      subscription_id: xxx,
      invoice_id: yyy
   }
   â†“
5ï¸âƒ£ Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹: Ø¯ÙØ¹Ø© Ø«Ø§Ù†ÙŠØ© 200 Ø±ÙŠØ§Ù„
   â†“ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ­Ø¯Ø«:
   - Subscription: paid = 700, remaining = 150
   - Invoice: Ù„Ø§ ØªØ²Ø§Ù„ 'unpaid'
   â†“
6ï¸âƒ£ Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†: Ø¯ÙØ¹Ø© Ø£Ø®ÙŠØ±Ø© 150 Ø±ÙŠØ§Ù„
   â†“ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ­Ø¯Ø«:
   - Subscription: paid = 850, remaining = 0, payment_status = 'paid' âœ…
   - Invoice: status = 'paid', paid_date = Ø§Ù„ÙŠÙˆÙ… âœ…
```

---

### 3. Ø§Ù„ØªØ­Ù‚Ù‚Ø§Øª ÙˆØ§Ù„Ø¶Ù…Ø§Ù†Ø§Øª

#### Ø¹Ù†Ø¯ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª:
```typescript
âœ… basePrice >= 0
âœ… discountAmount >= 0
âœ… Ø¥Ø°Ø§ percentage: discountAmount <= 100
âœ… Ø¥Ø°Ø§ amount: discountAmount <= basePrice
âœ… totalAmount = basePrice - discount
âœ… ØªÙ‚Ø±ÙŠØ¨ Ø¥Ù„Ù‰ Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†
```

#### Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø©:
```typescript
âœ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ù…ÙˆØ¬ÙˆØ¯
âœ… amount > 0
âœ… amount <= remaining_amount
âœ… ØªØ­Ø¯ÙŠØ« paid_amount Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
âœ… Ø¥Ø°Ø§ Ø¯ÙØ¹ ÙƒØ§Ù…Ù„ â†’ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¥Ù„Ù‰ 'paid'
```

#### Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©:
```typescript
âœ… Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© ÙØ±ÙŠØ¯ (INV-YYYYMM-####)
âœ… Ø±Ø¨Ø· ØµØ­ÙŠØ­ Ø¨Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
âœ… ØªÙˆØ§Ø±ÙŠØ® ØµØ­ÙŠØ­Ø© (issued_date <= due_date)
âœ… Ø§Ù„Ù…Ø¨Ù„Øº = total_amount Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ
```

---

## â­ Ù†Ù‚Ø§Ø· Ø§Ù„Ù‚ÙˆØ© {#Ù†Ù‚Ø§Ø·-Ø§Ù„Ù‚ÙˆØ©}

### 1. Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©
- âœ… Ø§Ø³ØªØ®Ø¯Ø§Ù… `FinancialService.calculateDiscount()` ÙŠØ¶Ù…Ù† Ø¯Ù‚Ø© Ù…ØªÙ†Ø§Ù‡ÙŠØ©
- âœ… Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…Ø¨Ø§Ù„Øº (Ù…Ù†Ø²Ù„ØªÙŠÙ† Ø¹Ø´Ø±ÙŠØªÙŠÙ†)
- âœ… Ù…Ù†Ø¹ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© (Ø®ØµÙ… ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)

### 2. Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
- âœ… Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ùƒ â†’ ÙØ§ØªÙˆØ±Ø© ØªÙÙ†Ø´Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© â†’ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø© ÙŠÙØ­Ø¯Ø«Ø§Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯ÙˆÙŠ

### 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª
- âœ… Ø«Ù„Ø§Ø« Ø­Ø§Ù„Ø§Øª Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ (active/expired/cancelled)
- âœ… Ø«Ù„Ø§Ø« Ø­Ø§Ù„Ø§Øª Ù„Ù„Ø¯ÙØ¹ (paid/partial/pending)
- âœ… Ø«Ù„Ø§Ø« Ø­Ø§Ù„Ø§Øª Ù„Ù„ÙØ§ØªÙˆØ±Ø© (paid/unpaid/cancelled)
- âœ… Ø§Ù†ØªÙ‚Ø§Ù„Ø§Øª Ù…Ù†Ø·Ù‚ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ø§Ù„Ø§Øª

### 4. Ø§Ù„Ø´ÙØ§ÙÙŠØ©
- âœ… Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
- âœ… Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØªØ¨Ø¹ ÙƒÙ„ Ø±ÙŠØ§Ù„ Ù…Ø¯ÙÙˆØ¹
- âœ… Ø±Ø¨Ø· Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø¨Ø§Ù„ÙÙˆØ§ØªÙŠØ±
- âœ… Ø£Ø±Ù‚Ø§Ù… Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…ØµØ±ÙÙŠØ©

### 5. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
- âœ… ØªØµÙ…ÙŠÙ… Ø­Ø¯ÙŠØ« ÙˆØ¬Ø°Ø§Ø¨
- âœ… Progress Bars Ù…Ø±Ø¦ÙŠØ©
- âœ… Ø£Ù„ÙˆØ§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø©
- âœ… Ø±Ø³ÙˆÙ… Ù…ØªØ­Ø±ÙƒØ© Ø³Ù„Ø³Ø©
- âœ… ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ø¶Ø­Ø©

### 6. Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
- âœ… `checkAndUpdateSubscriptionStatuses()` Ù„Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ
- âœ… ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
- âœ… ÙŠÙ…ÙƒÙ† Ø¬Ø¯ÙˆÙ„ØªÙ‡Ø§ ÙŠÙˆÙ…ÙŠØ§Ù‹

---

## âš ï¸ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª ÙˆØ§Ù„Ø«ØºØ±Ø§Øª {#Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª-ÙˆØ§Ù„Ø«ØºØ±Ø§Øª}

### 1. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªØªØ¨Ø¹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª (Audit Trail)
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù„Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆÙ…ØªÙ‰
Invoice.update(id, { amount: 1200 })
// âŒ Ù…Ù† Ù‚Ø§Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„ØªØºÙŠÙŠØ±ØŸ
// âŒ Ù…Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø§Ø¨Ù‚ØŸ
// âŒ Ù„Ù…Ø§Ø°Ø§ ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŸ
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- ğŸ”´ Ø¹Ø¯Ù… Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
- ğŸ”´ ØµØ¹ÙˆØ¨Ø© Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
- ğŸ”´ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø§Ø¡Ù„Ø©

---

### 2. Ø¹Ø¯Ù… Ø¯Ø¹Ù… Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ø­Ø¯
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// Ø§Ù„Ø¢Ù†: Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ø­Ø¯ â†’ ÙØ§ØªÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·
// Ù…Ø§Ø°Ø§ Ù„Ùˆ Ø£Ø±Ø§Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù† ÙÙˆØ§ØªÙŠØ± Ù…ØªØ¹Ø¯Ø¯Ø©ØŸ
// Ù…Ø«Ø§Ù„: ÙØ§ØªÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ© Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ù†ÙˆÙŠ
```

**Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ:**
```
Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ù†ÙˆÙŠ: 12,000 Ø±ÙŠØ§Ù„
Ø§Ù„Ù…Ø¹Ù„Ù† ÙŠØ±ÙŠØ¯: 12 ÙØ§ØªÙˆØ±Ø© Ø´Ù‡Ø±ÙŠØ© Ã— 1,000 Ø±ÙŠØ§Ù„
Ø§Ù„Ø­Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ: âŒ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…
```

---

### 3. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©
// âŒ Ø¥Ø´Ø¹Ø§Ø± Ù‚Ø¨Ù„ due_date Ø¨Ù€ 3 Ø£ÙŠØ§Ù…
// âŒ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ±
// âŒ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- ğŸ”´ ÙÙˆØ§ØªÙŠØ± Ù…ØªØ£Ø®Ø±Ø©
- ğŸ”´ Ù…Ø¹Ù„Ù†ÙŠÙ† ÙŠÙ†Ø³ÙˆÙ† Ø§Ù„Ø¯ÙØ¹
- ğŸ”´ Ø®Ø³Ø§Ø±Ø© Ø¥ÙŠØ±Ø§Ø¯Ø§Øª

---

### 4. Ø¹Ø¯Ù… Ø¯Ø¹Ù… Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ (VAT)
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
Invoice {
  amount: 1000  // âŒ Ù‡Ù„ Ù‡Ø°Ø§ Ø´Ø§Ù…Ù„ Ø¶Ø±ÙŠØ¨Ø© Ø£Ù… Ù„Ø§ØŸ
  // âŒ Ø£ÙŠÙ† Ø­Ù‚Ù„ vat_amountØŸ
  // âŒ Ø£ÙŠÙ† Ø­Ù‚Ù„ vat_percentageØŸ
}
```

**ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©:**
- Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© 15%
- ÙŠØ¬Ø¨ ÙØµÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¹Ù† Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©

---

### 5. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ Ø§Ù„ÙƒØ§Ù…Ù„
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// Ø¹Ù†Ø¯ Ø¥Ù„ØºØ§Ø¡ Ø§Ø´ØªØ±Ø§ÙƒØŒ ÙŠÙØ­Ø³Ø¨ Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
// Ù„ÙƒÙ† Ù„Ø§ ÙŠÙˆØ¬Ø¯:
// âŒ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯ (Refund)
// âŒ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
// âŒ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
```

**ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ©:**
```typescript
interface Refund {
  id: string;
  subscription_id: string;
  invoice_id: string;
  amount: number;
  refund_date: Date;
  refund_method: string;
  reason: string;
  status: 'pending' | 'completed' | 'cancelled';
}
```

---

### 6. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ pagination
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// ØµÙØ­Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØªØ¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ±
const invoices = await InvoiceAdminService.getAll();
// âŒ Ù…Ø§Ø°Ø§ Ù„Ùˆ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ 10,000 ÙØ§ØªÙˆØ±Ø©ØŸ
```

**Ø§Ù„ØªØ£Ø«ÙŠØ±:**
- ğŸ”´ Ø¨Ø·Ø¡ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„
- ğŸ”´ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ÙƒØ¨ÙŠØ± Ù„Ù„Ø°Ø§ÙƒØ±Ø©
- ğŸ”´ ØªØ¬Ø±Ø¨Ø© Ù…Ø³ØªØ®Ø¯Ù… Ø³ÙŠØ¦Ø©

---

### 7. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©
**Ø§Ù„Ù…ÙÙ‚ÙˆØ¯:**
```typescript
// âŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
// âŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ù†ÙØ§Ù‚Ø§Ù‹
// âŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
// âŒ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©
// âŒ ØªÙ‚Ø±ÙŠØ± Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
```

---

### 8. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙŠØ¯ÙˆÙŠØ©
// âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Moyasar/Tap/Stripe
// âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø§Ø¨Ø· Ø¯ÙØ¹ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
// âŒ Ø§Ù„Ù…Ø¹Ù„Ù† Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±Ø©
```

---

### 9. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙÙˆØ§ØªÙŠØ±
**Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:**
```typescript
// Ø¨Ø¹Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:
// âŒ Ù„Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„Ù…Ø¹Ù„Ù† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
// âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø± "Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± WhatsApp"
// âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø²Ø± "Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Email"
```

---

### 10. Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø³ÙŠØ§Ø³Ø§Øª Ø¯ÙØ¹ Ù…Ø±Ù†Ø©
**Ø§Ù„Ù…ÙÙ‚ÙˆØ¯:**
```typescript
// âŒ Ø¯ÙØ¹Ø§Øª Ù…ØªÙƒØ±Ø±Ø© (Recurring Payments)
// âŒ Ø£Ù‚Ø³Ø§Ø· Ù…Ø­Ø¯Ø¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
// âŒ Ø®ØµÙˆÙ…Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø¨ÙƒØ±
// âŒ Ø±Ø³ÙˆÙ… ØªØ£Ø®ÙŠØ± Ù„Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ£Ø®Ø±
```

---

## ğŸ’¡ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© {#Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª-Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©}

### Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1: ØªØ­Ø³ÙŠÙ†Ø§Øª Ø­Ø±Ø¬Ø© (Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©) ğŸ”´

#### 1.1 Ø¥Ø¶Ø§ÙØ© Ù†Ø¸Ø§Ù… Audit Trail
```typescript
interface InvoiceAudit {
  id: string;
  invoice_id: string;
  action: 'created' | 'updated' | 'deleted' | 'paid' | 'cancelled';
  changed_fields: Record<string, { old: any; new: any }>;
  performed_by: string;  // admin user ID
  performed_at: Date;
  ip_address?: string;
  notes?: string;
}
```

**Ø§Ù„ÙÙˆØ§Ø¦Ø¯:**
- âœ… ØªØªØ¨Ø¹ ÙƒØ§Ù…Ù„ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª
- âœ… Ù…Ø³Ø§Ø¡Ù„Ø© ÙˆØ§Ø¶Ø­Ø©
- âœ… Ø­Ù„ Ø§Ù„Ù†Ø²Ø§Ø¹Ø§Øª
- âœ… Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

**Ø§Ù„ØªÙ†ÙÙŠØ°:**
```typescript
// ÙÙŠ InvoiceAdminService
static async update(id: string, data: Partial<Invoice>, userId: string) {
  const oldInvoice = await this.getById(id);
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ§ØªÙˆØ±Ø©
  await adminDb.collection('invoices').doc(id).update(data);
  
  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚
  await AuditService.log({
    invoice_id: id,
    action: 'updated',
    changed_fields: compareObjects(oldInvoice, data),
    performed_by: userId,
    performed_at: new Date()
  });
}
```

---

#### 1.2 Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ (VAT)
```typescript
interface Invoice {
  // ... Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
  subtotal: number;           // Ø§Ù„Ù…Ø¨Ù„Øº Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
  vat_percentage: number;     // Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© (15)
  vat_amount: number;         // Ù…Ø¨Ù„Øº Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
  amount: number;             // Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (subtotal + vat_amount)
  tax_invoice_number?: string;// Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©
}
```

**Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:**
```typescript
// ÙÙŠ FinancialService
static calculateWithVAT(subtotal: number, vatPercentage: number = 15) {
  const vat_amount = Math.round(subtotal * (vatPercentage / 100) * 100) / 100;
  const total = subtotal + vat_amount;
  
  return {
    subtotal,
    vat_percentage: vatPercentage,
    vat_amount,
    total
  };
}
```

**Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
```
Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙØ±Ø¹ÙŠ:    850.00 Ø±ÙŠØ§Ù„
Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© (15%):   127.50 Ø±ÙŠØ§Ù„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:         977.50 Ø±ÙŠØ§Ù„
```

---

#### 1.3 Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
```typescript
interface Reminder {
  id: string;
  invoice_id: string;
  advertiser_id: string;
  reminder_type: 'due_soon' | 'overdue' | 'subscription_expiring';
  scheduled_date: Date;
  sent_date?: Date;
  status: 'pending' | 'sent' | 'failed';
  delivery_method: 'whatsapp' | 'email' | 'sms';
}
```

**Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª:**
```typescript
// 1. Ù‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ø¨Ù€ 3 Ø£ÙŠØ§Ù…
if (invoice.due_date - 3 days) {
  sendReminder({
    type: 'due_soon',
    message: `ØªØ°ÙƒÙŠØ±: ÙØ§ØªÙˆØ±Ø© ${invoice.invoice_number} Ù…Ø³ØªØ­Ù‚Ø© Ø®Ù„Ø§Ù„ 3 Ø£ÙŠØ§Ù…`
  });
}

// 2. Ø¹Ù†Ø¯ Ø§Ù„ØªØ£Ø®ÙŠØ±
if (today > invoice.due_date && invoice.status === 'unpaid') {
  sendReminder({
    type: 'overdue',
    message: `ØªÙ†Ø¨ÙŠÙ‡: ÙØ§ØªÙˆØ±Ø© ${invoice.invoice_number} Ù…ØªØ£Ø®Ø±Ø©`
  });
}

// 3. Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù€ 7 Ø£ÙŠØ§Ù…
if (subscription.end_date - 7 days) {
  sendReminder({
    type: 'subscription_expiring',
    message: `Ø³ÙŠÙ†ØªÙ‡ÙŠ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù…. Ù‡Ù„ ØªÙˆØ¯ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ØŸ`
  });
}
```

**Cron Job:**
```typescript
// ÙŠØ¹Ù…Ù„ ÙŠÙˆÙ…ÙŠØ§Ù‹ Ø§Ù„Ø³Ø§Ø¹Ø© 9 ØµØ¨Ø§Ø­Ø§Ù‹
export async function sendDailyReminders() {
  const reminders = await ReminderService.getPendingReminders();
  
  for (const reminder of reminders) {
    await NotificationService.send(reminder);
    await ReminderService.markAsSent(reminder.id);
  }
}
```

---

#### 1.4 Pagination Ù„Ù„ÙÙˆØ§ØªÙŠØ±
```typescript
interface PaginationParams {
  page: number;
  limit: number;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}

interface PaginatedResponse<T> {
  data: T[];
  total: number;
  page: number;
  totalPages: number;
  hasNext: boolean;
  hasPrev: boolean;
}

// ÙÙŠ InvoiceAdminService
static async getAllPaginated(params: PaginationParams): Promise<PaginatedResponse<Invoice>> {
  const { page = 1, limit = 20, sortBy = 'issued_date', sortOrder = 'desc' } = params;
  
  const offset = (page - 1) * limit;
  
  // Ø¬Ù„Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø¯Ø¯
  const totalSnapshot = await adminDb.collection('invoices').count().get();
  const total = totalSnapshot.data().count;
  
  // Ø¬Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
  const snapshot = await adminDb
    .collection('invoices')
    .orderBy(sortBy, sortOrder)
    .limit(limit)
    .offset(offset)
    .get();
  
  const data = snapshot.docs.map(doc => ({
    id: doc.id,
    ...doc.data()
  })) as Invoice[];
  
  return {
    data,
    total,
    page,
    totalPages: Math.ceil(total / limit),
    hasNext: page < Math.ceil(total / limit),
    hasPrev: page > 1
  };
}
```

---

### Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2: ØªØ­Ø³ÙŠÙ†Ø§Øª Ù…Ù‡Ù…Ø© (Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©) ğŸŸ¡

#### 2.1 Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯Ø§Øª (Refunds)
```typescript
interface Refund {
  id: string;
  subscription_id: string;
  invoice_id?: string;
  original_amount: number;      // Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£ØµÙ„ÙŠ
  refund_amount: number;        // Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
  refund_reason: string;        // Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
  refund_method: 'cash' | 'bank_transfer' | 'card';
  refund_date: Date;
  processed_by: string;         // admin user ID
  status: 'pending' | 'approved' | 'completed' | 'rejected';
  notes?: string;
  created_at: Date;
}

// Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ FinancialService
static async processRefund(data: {
  subscription_id: string;
  refund_amount: number;
  reason: string;
  method: string;
  notes?: string;
}): Promise<{
  refund_id: string;
  message: string;
}> {
  // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
  const subscription = await SubscriptionAdminService.getById(data.subscription_id);
  if (!subscription) throw new Error('Subscription not found');
  
  // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ø¹Ù‚ÙˆÙ„
  if (data.refund_amount > subscription.paid_amount) {
    throw new Error('Refund amount exceeds paid amount');
  }
  
  // 3. Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø¬Ù„ Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯
  const refund: Omit<Refund, 'id' | 'created_at'> = {
    subscription_id: data.subscription_id,
    original_amount: subscription.paid_amount,
    refund_amount: data.refund_amount,
    refund_reason: data.reason,
    refund_method: data.method,
    refund_date: new Date(),
    processed_by: 'admin_user_id', // Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†
    status: 'completed',
    notes: data.notes
  };
  
  const refundId = await RefundService.create(refund);
  
  // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø³ÙŠØ§Ø³Ø©)
  // ÙŠÙ…ÙƒÙ† Ø·Ø±Ø­ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† paid_amount
  
  return {
    refund_id: refundId,
    message: `Refund of ${data.refund_amount} SAR processed successfully`
  };
}
```

---

#### 2.2 ÙÙˆØ§ØªÙŠØ± Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ø­Ø¯
```typescript
// ØªØ¹Ø¯ÙŠÙ„ Subscription Ù„Ø¯Ø¹Ù… Ø®Ø·Ø© Ø§Ù„Ø¯ÙØ¹
interface Subscription {
  // ... Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
  payment_plan: {
    type: 'single' | 'installments' | 'recurring';
    installments_count?: number;  // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ø·
    installment_amount?: number;  // Ù…Ø¨Ù„Øº Ø§Ù„Ù‚Ø³Ø·
    installment_frequency?: 'weekly' | 'monthly' | 'quarterly';
  };
}

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ ÙÙˆØ§ØªÙŠØ± Ù…ØªØ¹Ø¯Ø¯Ø©
static async createInstallmentInvoices(
  subscriptionId: string,
  installmentsCount: number
): Promise<string[]> {
  const subscription = await SubscriptionAdminService.getById(subscriptionId);
  if (!subscription) throw new Error('Subscription not found');
  
  const installmentAmount = subscription.total_amount / installmentsCount;
  const invoiceIds: string[] = [];
  
  for (let i = 0; i < installmentsCount; i++) {
    const dueDate = new Date(subscription.start_date);
    dueDate.setMonth(dueDate.getMonth() + i);
    
    const invoice: Omit<Invoice, 'id' | 'created_at'> = {
      subscription_id: subscriptionId,
      invoice_number: await this.generateInvoiceNumber(),
      amount: installmentAmount,
      status: 'unpaid',
      issued_date: new Date(),
      due_date: dueDate
    };
    
    const invoiceId = await InvoiceAdminService.create(invoice);
    invoiceIds.push(invoiceId);
  }
  
  return invoiceIds;
}
```

**Ù…Ø«Ø§Ù„:**
```
Ø§Ø´ØªØ±Ø§Ùƒ Ø³Ù†ÙˆÙŠ: 12,000 Ø±ÙŠØ§Ù„
Ø§Ù„Ø®Ø·Ø©: 12 Ù‚Ø³Ø· Ø´Ù‡Ø±ÙŠ

Ø§Ù„Ù†ØªÙŠØ¬Ø©:
âœ… Invoice 1: 1,000 Ø±ÙŠØ§Ù„ - Ù…Ø³ØªØ­Ù‚ 01/11/2024
âœ… Invoice 2: 1,000 Ø±ÙŠØ§Ù„ - Ù…Ø³ØªØ­Ù‚ 01/12/2024
âœ… Invoice 3: 1,000 Ø±ÙŠØ§Ù„ - Ù…Ø³ØªØ­Ù‚ 01/01/2025
... ÙˆÙ‡ÙƒØ°Ø§
```

---

#### 2.3 ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©
```typescript
// Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
class FinancialReportService {
  
  // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
  static async getMonthlyRevenue(year: number) {
    const payments = await PaymentAdminService.getAll();
    
    const monthlyData = Array(12).fill(0);
    
    payments.forEach(payment => {
      const date = new Date(payment.payment_date);
      if (date.getFullYear() === year) {
        monthlyData[date.getMonth()] += payment.amount;
      }
    });
    
    return {
      year,
      months: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', ...],
      revenue: monthlyData,
      total: monthlyData.reduce((sum, val) => sum + val, 0)
    };
  }
  
  // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ù†ÙØ§Ù‚Ø§Ù‹
  static async getTopSpendingAdvertisers(limit: number = 10) {
    const allAdvertisers = await AdvertiserAdminService.getAll();
    
    const advertiserSpending = await Promise.all(
      allAdvertisers.map(async (advertiser) => {
        const summary = await FinancialService.getAdvertiserFinancialSummary(advertiser.id!);
        return {
          advertiser_id: advertiser.id,
          company_name: advertiser.company_name,
          total_spent: summary.total_spent,
          total_paid: summary.total_paid,
          subscriptions_count: summary.total_subscriptions
        };
      })
    );
    
    return advertiserSpending
      .sort((a, b) => b.total_paid - a.total_paid)
      .slice(0, limit);
  }
  
  // ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
  static async getOverdueReport() {
    const overdueInvoices = await InvoiceAdminService.getOverdueInvoices();
    
    const totalOverdue = overdueInvoices.reduce((sum, inv) => sum + inv.amount, 0);
    
    // ØªØ¬Ù…ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ù„Ù†
    const byAdvertiser = new Map();
    
    for (const invoice of overdueInvoices) {
      const subscription = await SubscriptionAdminService.getById(invoice.subscription_id);
      if (!subscription) continue;
      
      const advertiserId = subscription.advertiser_id;
      if (!byAdvertiser.has(advertiserId)) {
        byAdvertiser.set(advertiserId, {
          advertiser_id: advertiserId,
          invoices: [],
          total_overdue: 0
        });
      }
      
      const data = byAdvertiser.get(advertiserId);
      data.invoices.push(invoice);
      data.total_overdue += invoice.amount;
    }
    
    return {
      total_overdue_amount: totalOverdue,
      total_overdue_count: overdueInvoices.length,
      by_advertiser: Array.from(byAdvertiser.values())
    };
  }
  
  // ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø®ØµÙˆÙ…Ø§Øª
  static async getDiscountsReport(startDate: Date, endDate: Date) {
    const subscriptions = await SubscriptionAdminService.getAll();
    
    const filtered = subscriptions.filter(sub => {
      const created = new Date(sub.created_at);
      return created >= startDate && created <= endDate;
    });
    
    const totalBasePrice = filtered.reduce((sum, sub) => sum + sub.base_price, 0);
    const totalAfterDiscount = filtered.reduce((sum, sub) => sum + sub.total_amount, 0);
    const totalDiscount = totalBasePrice - totalAfterDiscount;
    
    return {
      period: { start: startDate, end: endDate },
      subscriptions_count: filtered.length,
      total_base_price: totalBasePrice,
      total_discount: totalDiscount,
      total_after_discount: totalAfterDiscount,
      average_discount_percentage: (totalDiscount / totalBasePrice) * 100
    };
  }
}
```

---

#### 2.4 Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
```typescript
// Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
class NotificationService {
  
  // Ø¥Ø±Ø³Ø§Ù„ ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± WhatsApp
  static async sendInvoiceViaWhatsApp(invoiceId: string) {
    const invoice = await InvoiceAdminService.getById(invoiceId);
    if (!invoice) throw new Error('Invoice not found');
    
    const subscription = await SubscriptionAdminService.getById(invoice.subscription_id);
    if (!subscription) throw new Error('Subscription not found');
    
    const advertiser = await AdvertiserAdminService.getById(subscription.advertiser_id);
    if (!advertiser || !advertiser.whatsapp) {
      throw new Error('Advertiser WhatsApp not found');
    }
    
    // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    const message = `
Ù…Ø±Ø­Ø¨Ø§Ù‹ ${advertiser.company_name} ğŸ‘‹

ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¬Ø¯Ø©:

ğŸ§¾ Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoice.invoice_number}
ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº: ${invoice.amount.toLocaleString('ar-SA')} Ø±ÙŠØ§Ù„
ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: ${new Date(invoice.due_date).toLocaleDateString('ar-SA')}

Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:
${process.env.NEXT_PUBLIC_SITE_URL}/invoices/${invoiceId}

Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§Ù…Ù„ÙƒÙ… Ù…Ø¹Ù†Ø§! ğŸŒŸ
    `.trim();
    
    // Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± WhatsApp API (Ù…Ø«Ù„ Twilio)
    // await twilioClient.messages.create({...});
    
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    await adminDb.collection('notifications').add({
      type: 'invoice_whatsapp',
      invoice_id: invoiceId,
      advertiser_id: advertiser.id,
      status: 'sent',
      sent_at: Timestamp.now()
    });
    
    return { success: true, message: 'Invoice sent via WhatsApp' };
  }
  
  // Ø¥Ø±Ø³Ø§Ù„ ÙØ§ØªÙˆØ±Ø© Ø¹Ø¨Ø± Email
  static async sendInvoiceViaEmail(invoiceId: string) {
    // Ù…Ø´Ø§Ø¨Ù‡ Ù„Ù„Ù€ WhatsApp Ù„ÙƒÙ† Ø¹Ø¨Ø± Email
    // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… SendGrid Ø£Ùˆ NodeMailer
  }
}

// API Endpoint Ø¬Ø¯ÙŠØ¯
// POST /api/invoices/[id]/send
export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const { id } = req.query;
  const { method } = req.body; // 'whatsapp' | 'email'
  
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }
  
  try {
    if (method === 'whatsapp') {
      await NotificationService.sendInvoiceViaWhatsApp(id as string);
    } else if (method === 'email') {
      await NotificationService.sendInvoiceViaEmail(id as string);
    }
    
    res.status(200).json({ success: true, message: 'Invoice sent successfully' });
  } catch (error: any) {
    res.status(500).json({ error: error.message });
  }
}
```

**ÙÙŠ ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
```tsx
<div className="flex gap-3">
  <button onClick={() => sendViaWhatsApp(invoiceId)}>
    ğŸ“± Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
  </button>
  <button onClick={() => sendViaEmail(invoiceId)}>
    ğŸ“§ Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯
  </button>
</div>
```

---

### Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3: ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©) ğŸŸ¢

#### 3.1 ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¨ÙˆØ§Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹
```typescript
// Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
class PaymentGatewayService {
  
  // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¯ÙØ¹
  static async createPaymentLink(invoiceId: string): Promise<{
    payment_url: string;
    payment_id: string;
  }> {
    const invoice = await InvoiceAdminService.getById(invoiceId);
    if (!invoice) throw new Error('Invoice not found');
    
    // Ù…Ø«Ø§Ù„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Moyasar
    const moyasarResponse = await fetch('https://api.moyasar.com/v1/payments', {
      method: 'POST',
      headers: {
        'Authorization': `Basic ${Buffer.from(process.env.MOYASAR_API_KEY!).toString('base64')}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        amount: invoice.amount * 100, // Ø¨Ø§Ù„Ù‡Ù„Ù„Ø©
        currency: 'SAR',
        description: `Payment for invoice ${invoice.invoice_number}`,
        callback_url: `${process.env.NEXT_PUBLIC_SITE_URL}/api/payments/callback`,
        source: {
          type: 'creditcard'
        },
        metadata: {
          invoice_id: invoiceId
        }
      })
    });
    
    const data = await moyasarResponse.json();
    
    return {
      payment_url: data.source.transaction_url,
      payment_id: data.id
    };
  }
  
  // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±Ø¯ Ø§Ù„Ø¯ÙØ¹
  static async handlePaymentCallback(paymentId: string) {
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Moyasar
    const moyasarResponse = await fetch(`https://api.moyasar.com/v1/payments/${paymentId}`, {
      headers: {
        'Authorization': `Basic ${Buffer.from(process.env.MOYASAR_API_KEY!).toString('base64')}`
      }
    });
    
    const payment = await moyasarResponse.json();
    
    if (payment.status === 'paid') {
      const invoiceId = payment.metadata.invoice_id;
      const amount = payment.amount / 100; // Ù…Ù† Ø§Ù„Ù‡Ù„Ù„Ø© Ù„Ù„Ø±ÙŠØ§Ù„
      
      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯ÙØ¹Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
      await FinancialService.recordPayment({
        subscription_id: payment.metadata.subscription_id,
        invoice_id: invoiceId,
        amount,
        payment_date: new Date(),
        payment_method: 'online',
        transaction_id: paymentId,
        notes: 'Online payment via Moyasar'
      });
    }
  }
}
```

**ÙÙŠ Ø§Ù„ÙØ§ØªÙˆØ±Ø©:**
```tsx
<button onClick={async () => {
  const { payment_url } = await createPaymentLink(invoiceId);
  window.open(payment_url, '_blank');
}}>
  ğŸ’³ Ø§Ø¯ÙØ¹ Ø§Ù„Ø¢Ù†
</button>
```

---

#### 3.2 ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (PDF/Excel)
```typescript
// Ø®Ø¯Ù…Ø© Ø§Ù„ØªØµØ¯ÙŠØ±
class ExportService {
  
  // ØªØµØ¯ÙŠØ± ÙØ§ØªÙˆØ±Ø© ÙƒÙ€ PDF
  static async exportInvoiceToPDF(invoiceId: string): Promise<Buffer> {
    const invoice = await InvoiceAdminService.getById(invoiceId);
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ pdfkit Ø£Ùˆ puppeteer
    
    const PDFDocument = require('pdfkit');
    const doc = new PDFDocument();
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    doc.fontSize(20).text('ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©', { align: 'center' });
    doc.fontSize(12).text(`Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoice.invoice_number}`);
    // ... Ø§Ù„Ù…Ø²ÙŠØ¯
    
    return doc;
  }
  
  // ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙƒÙ€ Excel
  static async exportPaymentsToExcel(
    startDate: Date,
    endDate: Date
  ): Promise<Buffer> {
    const payments = await PaymentAdminService.getAll();
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ exceljs
    const ExcelJS = require('exceljs');
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª');
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
    worksheet.columns = [
      { header: 'Ø§Ù„ØªØ§Ø±ÙŠØ®', key: 'date', width: 15 },
      { header: 'Ø§Ù„Ù…Ø¨Ù„Øº', key: 'amount', width: 15 },
      { header: 'Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©', key: 'method', width: 15 },
      // ... Ø§Ù„Ù…Ø²ÙŠØ¯
    ];
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    payments.forEach(payment => {
      worksheet.addRow({
        date: new Date(payment.payment_date).toLocaleDateString('ar-SA'),
        amount: payment.amount,
        method: payment.payment_method
      });
    });
    
    return await workbook.xlsx.writeBuffer();
  }
}
```

---

#### 3.3 Dashboard Ù…Ø§Ù„ÙŠ Ù…ØªÙ‚Ø¯Ù…
```tsx
// ØµÙØ­Ø© Dashboard Ù…Ø§Ù„ÙŠ Ø¬Ø¯ÙŠØ¯Ø©
// /admin/financial-dashboard

export default function FinancialDashboard() {
  return (
    <div className="container mx-auto px-4 py-8">
      {/* KPIs Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */}
      <div className="grid grid-cols-4 gap-6 mb-8">
        <KPICard
          title="Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©"
          value="45,000 Ø±ÙŠØ§Ù„"
          change="+12%"
          trend="up"
        />
        <KPICard
          title="Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØºÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©"
          value="15"
          change="-3"
          trend="down"
        />
        <KPICard
          title="Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†"
          value="87"
          change="+5"
          trend="up"
        />
        <KPICard
          title="Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©"
          value="1,200 Ø±ÙŠØ§Ù„"
          change="+8%"
          trend="up"
        />
      </div>
      
      {/* Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */}
      <div className="grid grid-cols-2 gap-6 mb-8">
        {/* Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© */}
        <RevenueChart data={monthlyRevenue} />
        
        {/* Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ */}
        <PaymentMethodsChart data={paymentMethods} />
      </div>
      
      {/* Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª */}
      <div className="grid grid-cols-2 gap-6">
        {/* Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø¹Ù„Ù†ÙŠÙ† Ø¥Ù†ÙØ§Ù‚Ø§Ù‹ */}
        <TopSpendersTable data={topSpenders} />
        
        {/* Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© */}
        <OverdueInvoicesTable data={overdueInvoices} />
      </div>
    </div>
  );
}
```

---

## ğŸ“‹ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° {#Ø®Ø·Ø©-Ø§Ù„ØªÙ†ÙÙŠØ°}

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø© (Ø£Ø³Ø¨ÙˆØ¹ 1-2)
```
Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ© ğŸ”´

âœ… Day 1-3: Ø¥Ø¶Ø§ÙØ© Audit Trail
   - Ø¥Ù†Ø´Ø§Ø¡ model Ùˆservice
   - ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
   - Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„

âœ… Day 4-6: Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ (VAT)
   - ØªØ¹Ø¯ÙŠÙ„ Invoice model
   - ØªØ­Ø¯ÙŠØ« FinancialService
   - ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…

âœ… Day 7-10: Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª
   - Ø¥Ù†Ø´Ø§Ø¡ Reminder model
   - Ø¨Ù†Ø§Ø¡ ReminderService
   - Ø¥Ø¹Ø¯Ø§Ø¯ Cron Jobs

âœ… Day 11-14: Pagination
   - ØªØ¹Ø¯ÙŠÙ„ API endpoints
   - ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø§Øª
   - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© (Ø£Ø³Ø¨ÙˆØ¹ 3-4)
```
Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© ğŸŸ¡

âœ… Week 3:
   - Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ±Ø¯Ø§Ø¯Ø§Øª
   - ÙÙˆØ§ØªÙŠØ± Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙˆØ§Ø­Ø¯
   - ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ© Ø£Ø³Ø§Ø³ÙŠØ©

âœ… Week 4:
   - Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (WhatsApp)
   - Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Email)
   - ØªØµØ¯ÙŠØ± PDF Ù„Ù„ÙÙˆØ§ØªÙŠØ±
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© (Ø£Ø³Ø¨ÙˆØ¹ 5-6)
```
Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© ğŸŸ¢

âœ… Week 5:
   - ØªÙƒØ§Ù…Ù„ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ (Moyasar)
   - Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
   - Ù…Ø¹Ø§Ù„Ø¬Ø© Callbacks

âœ… Week 6:
   - Dashboard Ù…Ø§Ù„ÙŠ Ù…ØªÙ‚Ø¯Ù…
   - Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© (Charts)
   - ØªØµØ¯ÙŠØ± Excel Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±
```

---

### Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ§Ù„Ù†Ø´Ø± (Ø£Ø³Ø¨ÙˆØ¹ 7)
```
âœ… Week 7:
   - Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª
   - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ø¯Ø§Ø¡
   - Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ø§Ù†
   - Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
   - Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ
```

---

## ğŸ›¡ï¸ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø¶Ù…Ø§Ù† {#Ù…Ø¹Ø§ÙŠÙŠØ±-Ø§Ù„Ø¬ÙˆØ¯Ø©}

### 1. Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª (Testing)
```typescript
// Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª FinancialService
describe('FinancialService', () => {
  
  test('calculateDiscount: Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©', () => {
    const result = FinancialService.calculateDiscount(1000, 'percentage', 15);
    expect(result.discount_value).toBe(150);
    expect(result.total_amount).toBe(850);
  });
  
  test('calculateDiscount: Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø®ØµÙ… Ø£ÙƒØ¨Ø± Ù…Ù† 100%', () => {
    expect(() => {
      FinancialService.calculateDiscount(1000, 'percentage', 150);
    }).toThrow('Discount percentage cannot exceed 100%');
  });
  
  test('recordPayment: ØªØ­Ø¯ÙŠØ« ØµØ­ÙŠØ­ Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ', async () => {
    const paymentId = await FinancialService.recordPayment({
      subscription_id: 'test_sub',
      amount: 500,
      payment_date: new Date()
    });
    
    const subscription = await SubscriptionAdminService.getById('test_sub');
    expect(subscription.paid_amount).toBeGreaterThan(0);
  });
});
```

---

### 2. Ø§Ù„ØªØ­Ù‚Ù‚Ø§Øª (Validations)
```typescript
// Ù‚Ø¨Ù„ Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø©
function validateInvoiceData(data: Partial<Invoice>) {
  if (!data.subscription_id) {
    throw new Error('Subscription ID is required');
  }
  
  if (data.amount !== undefined && data.amount <= 0) {
    throw new Error('Amount must be greater than zero');
  }
  
  if (data.issued_date && data.due_date) {
    if (new Date(data.due_date) < new Date(data.issued_date)) {
      throw new Error('Due date must be after issued date');
    }
  }
}
```

---

### 3. Ø§Ù„Ø£Ù…Ø§Ù† (Security)
```typescript
// ÙÙŠ Ø¬Ù…ÙŠØ¹ API endpoints
export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  try {
    // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªÙˆÙƒÙ†
    const token = req.headers.authorization?.replace('Bearer ', '');
    if (!token) {
      return res.status(401).json({ error: 'Unauthorized' });
    }
    
    // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    const user = await verifyAdminToken(token);
    if (!user || user.role !== 'admin') {
      return res.status(403).json({ error: 'Forbidden' });
    }
    
    // 3. Validate input
    const errors = validateInput(req.body);
    if (errors.length > 0) {
      return res.status(400).json({ errors });
    }
    
    // 4. ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
    const result = await performOperation(req.body);
    
    // 5. ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Audit Log
    await AuditService.log({
      action: 'invoice_created',
      user_id: user.id,
      data: req.body
    });
    
    res.status(200).json(result);
    
  } catch (error: any) {
    console.error('Error:', error);
    res.status(500).json({ error: error.message });
  }
}
```

---

### 4. Ø§Ù„Ø£Ø¯Ø§Ø¡ (Performance)
```typescript
// Ø§Ø³ØªØ®Ø¯Ø§Ù… Caching Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©
import { Redis } from 'ioredis';
const redis = new Redis(process.env.REDIS_URL);

// ÙÙŠ InvoiceAdminService
static async getById(id: string): Promise<Invoice | null> {
  // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ù…Ù† Cache
  const cached = await redis.get(`invoice:${id}`);
  if (cached) {
    return JSON.parse(cached);
  }
  
  // Ø¬Ù„Ø¨ Ù…Ù† Firebase
  const invoice = await adminDb.collection('invoices').doc(id).get();
  if (!invoice.exists) return null;
  
  const data = { id: invoice.id, ...invoice.data() } as Invoice;
  
  // Ø­ÙØ¸ ÙÙŠ Cache Ù„Ù…Ø¯Ø© 5 Ø¯Ù‚Ø§Ø¦Ù‚
  await redis.setex(`invoice:${id}`, 300, JSON.stringify(data));
  
  return data;
}
```

---

## ğŸ“Š Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ (KPIs)

### Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª:
```
âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ audit trail
âŒ Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©
âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
âŒ ØµÙØ­Ø§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¨Ø·ÙŠØ¦Ø© (>3 Ø«ÙˆØ§Ù†)
âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
âŒ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù…Ø­Ø¯ÙˆØ¯Ø© Ø¬Ø¯Ø§Ù‹
```

### Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª:
```
âœ… 100% Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Audit Trail
âœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙˆØ§ØªÙŠØ± ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©
âœ… Ø¥Ø±Ø³Ø§Ù„ 3 Ø£Ù†ÙˆØ§Ø¹ Ù…Ù† Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
âœ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø§Øª ÙÙŠ <1 Ø«Ø§Ù†ÙŠØ© (Ù…Ø¹ Pagination)
âœ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø¹Ø¨Ø± WhatsApp/Email Ø¨Ø¶ØºØ·Ø© Ø²Ø±
âœ… 10+ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©
âœ… ØªÙƒØ§Ù…Ù„ ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹
```

---

## ğŸ¯ Ø§Ù„Ø®Ù„Ø§ØµØ© ÙˆØ§Ù„ØªÙˆØµÙŠØ§Øª

### âœ… Ù…Ø§ Ù‡Ùˆ Ù…Ù…ØªØ§Ø² Ø­Ø§Ù„ÙŠØ§Ù‹:
1. **Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø©**: Ù…Ù†Ø¸Ù…Ø© ÙˆÙ…Ù†Ø·Ù‚ÙŠØ© Ø¬Ø¯Ø§Ù‹
2. **FinancialService**: Ù‚Ù„Ø¨ Ø§Ù„Ù†Ø¸Ø§Ù… Ù‚ÙˆÙŠ ÙˆØ¯Ù‚ÙŠÙ‚
3. **Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ**: Ø¨ÙŠÙ† Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª ÙˆØ§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª
4. **ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…**: Ø­Ø¯ÙŠØ«Ø© ÙˆØ¬Ø°Ø§Ø¨Ø©
5. **Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©**: `/advertisers/[id]/financial` Ø±Ø§Ø¦Ø¹Ø©!

### âš ï¸ Ù…Ø§ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ† Ø¹Ø§Ø¬Ù„:
1. **Audit Trail**: Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ù…Ø³Ø§Ø¡Ù„Ø©
2. **Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨**: Ù…Ø·Ù„ÙˆØ¨ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
3. **Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª**: Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©
4. **Pagination**: Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø¯Ø§Ø¡

### ğŸš€ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©:
1. **Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1** (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø­Ø±Ø¬Ø©)
2. **Ø§Ø®ØªØ¨Ø± ÙƒÙ„ Ù…ÙŠØ²Ø©** Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„ØªØ§Ù„ÙŠØ©
3. **ÙˆØ«Ù‚ ÙƒÙ„ Ø´ÙŠØ¡** Ù„Ù„ÙØ±ÙŠÙ‚
4. **Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ feedback** Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†

---

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù… ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©

Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙŠÙ…Ø«Ù„:
- âœ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
- âœ… ØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ø«ØºØ±Ø§Øª
- âœ… Ø­Ù„ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ© ÙˆÙ‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
- âœ… Ø®Ø·Ø© ØªÙ†ÙÙŠØ° ÙˆØ§Ø¶Ø­Ø© ÙˆÙ…Ø±Ø­Ù„ÙŠØ©

**Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹ØŒ ÙˆØ§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ø³ØªØ¬Ø¹Ù„Ù‡ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ù…Ø¹Ø§ÙŠÙŠØ± Ø¹Ø§Ù„Ù…ÙŠØ©! ğŸŒŸ**

---

**ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ø¯Ù‚Ø© ÙˆÙ…Ù‡Ù†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©**
**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ù†ÙˆÙÙ…Ø¨Ø± 2024**

